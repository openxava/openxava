<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>Groovy - OpenXava</title>
    <link rel="stylesheet" href="static/style.css" type="text/css">
  </head>
  <body>
    <div class="wiki" id="content_view" style="display: block;">
      <h1 id="toc0"><a name="Groovy"></a> <span id="breadcrumbs"> <span id="openxava">
            <a href="https://www.openxava.org/"> <span>o</span>pen<span>x</span>ava
              </a> </span> / <a href="index_es.html">documentación</a> / </span>
        Groovy</h1>
      <a href="https://groovy-lang.org/">Groovy</a> es un lenguaje ágil y
      dinámico para la plataforma Java. A partir de OpenXava 4m6 puedes escribir
      el código de tu aplicación usando Groovy en vez de Java. Incluso puedes
      combinar ambos lenguajes en la misma aplicación.<br>
      <h2 id="toc1"><a name="Groovy-Configurar Eclipse"></a>Configurar OpenXava
        Studio</h2>
      La forma más fácil de trabajar con Groovy en OpenXava es usando el plugin
      de <a href="https://github.com/groovy/groovy-eclipse">Groovy para Eclipse</a>.
      Dado que OpenXava Studio está basado en Eclipse, puedes instalar el plugin
      en él. En OpenXava Studio ve al menú <i>Help &gt; Eclipse Marketplace</i>
      y busca por "Groovy". Instala el que se llama"Groovy Development Tools":</div>
    <img src="files/install-groovy-plugin.png" alt="">
    <div class="wiki" style="display: block;">Si estás usando una versión de
      OpenXava anterior a v5.0 ve a <em>Preferences &gt; Groovy &gt; Compiler</em>
      y escoge <em>Groovy Compiler 1.8</em>.<br>
      Has de dar la naturaleza Groovy a tu proyecto OpenXava: pulsa en el botón
      de la derecha de tu proyecto, y escoge <em>Configure &gt; Convert to
        Groovy project</em>. Los proyectos OpenXava creados desde v4m6 hasta la
      v5.9.1 tienen la naturaleza Groovy por defecto, pero a los de OpenXava v6
      y v7 hay que darles la naturaleza Groovy explicitamente.<br>
      A partir de ahora, podrás añadir clases Groovy a tu proyecto, o convertir
      algunas de tus clases Java en clases Groovy, y simplemente funcionará.
      Cuando grabes una clase <em>.groovy</em> se compilará en <em>.class</em>
      automaticamente. Puedes poner tu código Grovvy en la carpeta in <i>src/main/java</i>
      de tu proyecto con OpenXava v7 o en cualquier carpeta de código fuente en
      versiones anteriores de OpenXava.
      <h2 id="toc3"><a name="Groovy-Desde la línea de órdenes"></a>Algún código
        de ejemplo</h2>
      Puedes escribir las entidades JPA con Groovy:<br>
      <style type="text/css"><!--
/**
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 */
.groovy  {font-family:monospace;}
.groovy .imp {font-weight: bold; color: red;}
.groovy .kw1 {color: #b1b100;}
.groovy .kw2 {color: #000000; font-weight: bold;}
.groovy .kw3 {color: #aaaadd; font-weight: bold;}
.groovy .kw4 {color: #993333;}
.groovy .kw5 {color: #663399;}
.groovy .kw6 {color: #CC0099;}
.groovy .kw7 {color: #FFCC33;}
.groovy .kw8 {color: #993399;}
.groovy .kw9 {color: #993399; font-weight: bold;}
.groovy .co1 {color: #808080; font-style: italic;}
.groovy .co2 {color: #a1a100;}
.groovy .co3 {color: #808080; font-style: italic;}
.groovy .coMULTI {color: #808080; font-style: italic;}
.groovy .es0 {color: #000099; font-weight: bold;}
.groovy .br0 {color: #66cc66;}
.groovy .sy0 {color: #66cc66;}
.groovy .st0 {color: #ff0000;}
.groovy .nu0 {color: #cc66cc;}
.groovy .me1 {color: #006600;}
.groovy .me2 {color: #006600;}
.groovy .re0 {color: #0000ff;}
.groovy span.xtra { display:block; }

-->
</style><pre class="groovy"><span class="kw2">package</span> <span class="co2">org.openxava.test.model</span><span
class="sy0">;</span>
&nbsp;
<span class="kw2">import</span> <span class="co2">javax.persistence.*</span>
&nbsp;
<span class="kw2">import</span> <span class="co2">org.openxava.annotations.*</span>
<span class="kw2">import</span> <span class="co2">org.openxava.calculators.*</span><br><span
class="kw2">import</span> <span class="co2">org.openxava.model.*</span><br><span
class="kw2">import</span> <span class="co2">org.openxava.jpa.*</span>
&nbsp;
@<span class="kw3">Entity</span>
@Table<span class="br0">(</span>name<span class="sy0">=</span><span class="st0">"TOrder"</span><span
class="br0">)</span>
@<span class="kw3">View</span><span class="br0">(</span>members<span class="sy0">=</span><span
class="st0">"""
    year, number, date;
    customer;
    details;
    amount;
    remarks
    """</span>
<span class="br0">)</span>
&nbsp;
<span class="kw2">class</span> Order <span class="kw2">extends</span> Identifiable <span
class="br0">{</span>
&nbsp;
    @Column<span class="br0">(</span>length<span class="sy0">=</span><span class="nu0">4</span><span
class="br0">)</span>
    @DefaultValueCalculator<span class="br0">(</span>CurrentYearCalculator.<span
class="kw2">class</span><span class="br0">)</span>
    <span class="kw4">int</span> year
&nbsp;
    @Column<span class="br0">(</span>length<span class="sy0">=</span><span class="nu0">6</span><span
class="br0">)</span>
    <span class="kw4">int</span> number
&nbsp;
    @Required
    @DefaultValueCalculator<span class="br0">(</span>CurrentDateCalculator.<span
class="kw2">class</span><span class="br0">)</span>
    <span class="kw3">Date</span> date
&nbsp;
    @ManyToOne<span class="br0">(</span>fetch<span class="sy0">=</span>FetchType.<span
class="me1">LAZY</span>, optional<span class="sy0">=</span><span class="kw2">false</span><span
class="br0">)</span>
    @ReferenceView<span class="br0">(</span><span class="st0">"Simplest"</span><span
class="br0">)</span>
    Customer customer
&nbsp;
    @OneToMany<span class="br0">(</span>mappedBy<span class="sy0">=</span><span
class="st0">"parent"</span>, cascade<span class="sy0">=</span>CascadeType.<span
class="me1">ALL</span><span class="br0">)</span>
    @ListProperties<span class="br0">(</span><span class="st0">"product.number, product.description, quantity, product.unitPrice, amount"</span><span
class="br0">)</span>
    Collection<span class="sy0">&lt;</span>OrderDetail<span class="sy0">&gt;</span> details <span
class="sy0">=</span> <span class="kw2">new</span> ArrayList<span class="sy0">&lt;</span>OrderDetail<span
class="sy0">&gt;</span><span class="br0">(</span><span class="br0">)</span>
&nbsp;
    @Stereotype<span class="br0">(</span><span class="st0">"MEMO"</span><span class="br0">)</span>
    <span class="kw3">String</span> remarks
&nbsp;
    @Stereotype<span class="br0">(</span><span class="st0">"MONEY"</span><span class="br0">)</span>
    <span class="kw3">BigDecimal</span> getAmount<span class="br0">(</span><span
class="br0">)</span> <span class="br0">{</span>
        <span class="kw3">BigDecimal</span> result <span class="sy0">=</span> <span
class="nu0">0</span>
        details.<span class="kw5">each</span> <span class="br0">{</span> OrderDetail detail <span
class="sy0">-&gt;</span>
            result <span class="sy0">+=</span> detail.<span class="me1">amount</span>
        <span class="br0">}</span>
        <span class="kw2">return</span> result
    <span class="br0">}</span>
&nbsp;
    @PrePersist
    <span class="kw4">void</span> calculateNumber<span class="br0">(</span><span
class="br0">)</span> <span class="kw2">throws</span> <span class="kw3">Exception</span> <span
class="br0">{</span>
        Query query <span class="sy0">=</span> XPersistence.<span class="me1">getManager</span><span
class="br0">(</span><span class="br0">)</span>
            .<span class="me1">createQuery</span><span class="br0">(</span><span
class="st0">"select max(o.number) from Order o "</span> <span class="sy0">+</span>
                    <span class="st0">"where o.year = :year"</span><span class="br0">)</span>
        query.<span class="me1">setParameter</span><span class="br0">(</span><span
class="st0">"year"</span>, year<span class="br0">)</span>
        <span class="kw3">Integer</span> lastNumber <span class="sy0">=</span> <span
class="br0">(</span><span class="kw3">Integer</span><span class="br0">)</span> query.<span
class="me1">getSingleResult</span><span class="br0">(</span><span class="br0">)</span>
        <span class="kw2">this</span>.<span class="me1">number</span> <span class="sy0">=</span> lastNumber <span
class="sy0">==</span> <span class="kw2">null</span><span class="sy0">?</span><span
class="nu0">1</span>:lastNumber <span class="sy0">+</span> <span class="nu0">1</span>
    <span class="br0">}</span>
&nbsp;
<span class="br0">}</span>
&nbsp;</pre>
      O las acciones:<br>
      <style type="text/css"><!--
/**
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 */
.groovy  {font-family:monospace;}
.groovy .imp {font-weight: bold; color: red;}
.groovy .kw1 {color: #b1b100;}
.groovy .kw2 {color: #000000; font-weight: bold;}
.groovy .kw3 {color: #aaaadd; font-weight: bold;}
.groovy .kw4 {color: #993333;}
.groovy .kw5 {color: #663399;}
.groovy .kw6 {color: #CC0099;}
.groovy .kw7 {color: #FFCC33;}
.groovy .kw8 {color: #993399;}
.groovy .kw9 {color: #993399; font-weight: bold;}
.groovy .co1 {color: #808080; font-style: italic;}
.groovy .co2 {color: #a1a100;}
.groovy .co3 {color: #808080; font-style: italic;}
.groovy .coMULTI {color: #808080; font-style: italic;}
.groovy .es0 {color: #000099; font-weight: bold;}
.groovy .br0 {color: #66cc66;}
.groovy .sy0 {color: #66cc66;}
.groovy .st0 {color: #ff0000;}
.groovy .nu0 {color: #cc66cc;}
.groovy .me1 {color: #006600;}
.groovy .me2 {color: #006600;}
.groovy .re0 {color: #0000ff;}
.groovy span.xtra { display:block; }

-->
</style><pre class="groovy"><span class="kw2">package</span> <span class="co2">org.openxava.test.actions</span>
&nbsp;
<span class="kw2">import</span> <span class="co2">org.openxava.actions.*</span>
&nbsp;
<span class="kw2">class</span> ChangeYearConditionAction <span class="kw2">extends</span> TabBaseAction <span
class="br0">{</span>
&nbsp;
    <span class="kw4">int</span> year<span class="sy0">;</span>
&nbsp;
    <span class="kw4">void</span> <span class="kw9">execute</span><span class="br0">(</span><span
class="br0">)</span> <span class="kw2">throws</span> <span class="kw3">Exception</span> <span
class="br0">{</span>
        tab.<span class="me1">setConditionValue</span><span class="br0">(</span><span
class="st0">"year"</span>, year<span class="br0">)</span>
    <span class="br0">}</span>
&nbsp;
<span class="br0">}</span></pre>
      Incluso las pruebas JUnit:<br>
      <style type="text/css"><!--
/**
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 */
.groovy  {font-family:monospace;}
.groovy .imp {font-weight: bold; color: red;}
.groovy .kw1 {color: #b1b100;}
.groovy .kw2 {color: #000000; font-weight: bold;}
.groovy .kw3 {color: #aaaadd; font-weight: bold;}
.groovy .kw4 {color: #993333;}
.groovy .kw5 {color: #663399;}
.groovy .kw6 {color: #CC0099;}
.groovy .kw7 {color: #FFCC33;}
.groovy .kw8 {color: #993399;}
.groovy .kw9 {color: #993399; font-weight: bold;}
.groovy .co1 {color: #808080; font-style: italic;}
.groovy .co2 {color: #a1a100;}
.groovy .co3 {color: #808080; font-style: italic;}
.groovy .coMULTI {color: #808080; font-style: italic;}
.groovy .es0 {color: #000099; font-weight: bold;}
.groovy .br0 {color: #66cc66;}
.groovy .sy0 {color: #66cc66;}
.groovy .st0 {color: #ff0000;}
.groovy .nu0 {color: #cc66cc;}
.groovy .me1 {color: #006600;}
.groovy .me2 {color: #006600;}
.groovy .re0 {color: #0000ff;}
.groovy span.xtra { display:block; }

-->
</style><pre class="groovy"><span class="kw2">package</span> <span class="co2">org.openxava.test.tests</span>
&nbsp;
<span class="kw2">import</span> <span class="co2">javax.persistence.*</span>
&nbsp;
<span class="kw2">import</span> <span class="co2">org.openxava.tests.*</span>
<span class="kw2">import</span> <span class="co2">org.openxava.util.*</span>
&nbsp;
<span class="kw2">import</span> <span class="co2">com.gargoylesoftware.htmlunit.html.*</span>
&nbsp;
<span class="kw2">import</span> <span class="co2">static</span> org.<span class="me1">openxava</span>.<span
class="me1">jpa</span>.<span class="me1">XPersistence</span>.<span class="sy0">*</span>
&nbsp;
<span class="kw2">class</span> OrderTest <span class="kw2">extends</span> ModuleTestBase <span
class="br0">{</span>
&nbsp;
    OrderTest<span class="br0">(</span><span class="kw3">String</span> testName<span
class="br0">)</span> <span class="br0">{</span>
        <span class="kw2">super</span><span class="br0">(</span>testName, <span
class="st0">"Order"</span><span class="br0">)</span>
    <span class="br0">}</span>
&nbsp;
    <span class="kw4">void</span> testCalculatedPropertiesFromCollection_generatedValueOnPersistRefreshedInView<span
class="br0">(</span><span class="br0">)</span>
        <span class="kw2">throws</span> <span class="kw3">Exception</span>
    <span class="br0">{</span>
        <span class="kw3">String</span> nextNumber <span class="sy0">=</span> getNextNumber<span
class="br0">(</span><span class="br0">)</span>
        <span class="kw9">execute</span><span class="br0">(</span><span class="st0">"CRUD.new"</span><span
class="br0">)</span>
        assertValue<span class="br0">(</span><span class="st0">"number"</span>, <span
class="st0">""</span><span class="br0">)</span>
        setValue<span class="br0">(</span><span class="st0">"customer.number"</span>, <span
class="st0">"1"</span><span class="br0">)</span>
        assertValue<span class="br0">(</span><span class="st0">"customer.name"</span>, <span
class="st0">"Javi"</span><span class="br0">)</span>
        assertCollectionRowCount<span class="br0">(</span><span class="st0">"details"</span>, <span
class="nu0">0</span><span class="br0">)</span>
        <span class="kw9">execute</span><span class="br0">(</span><span class="st0">"Collection.new"</span>, <span
class="st0">"viewObject=xava_view_details"</span><span class="br0">)</span>
        setValue<span class="br0">(</span><span class="st0">"product.number"</span>, <span
class="st0">"1"</span><span class="br0">)</span>
        assertValue<span class="br0">(</span><span class="st0">"product.description"</span>, <span
class="st0">"MULTAS DE TRAFICO"</span><span class="br0">)</span>
        assertValue<span class="br0">(</span><span class="st0">"product.unitPrice"</span>, <span
class="st0">"11.00"</span><span class="br0">)</span>
        setValue<span class="br0">(</span><span class="st0">"quantity"</span>, <span
class="st0">"10"</span><span class="br0">)</span>
        assertValue<span class="br0">(</span><span class="st0">"amount"</span>, <span
class="st0">"110.00"</span><span class="br0">)</span>
        <span class="kw9">execute</span><span class="br0">(</span><span class="st0">"Collection.save"</span><span
class="br0">)</span>
        assertNoErrors<span class="br0">(</span><span class="br0">)</span>
        assertCollectionRowCount<span class="br0">(</span><span class="st0">"details"</span>, <span
class="nu0">1</span><span class="br0">)</span>
        assertValue<span class="br0">(</span><span class="st0">"amount"</span>, <span
class="st0">"110.00"</span><span class="br0">)</span>
        assertValue<span class="br0">(</span><span class="st0">"number"</span>, nextNumber<span
class="br0">)</span>
        <span class="kw9">execute</span><span class="br0">(</span><span class="st0">"CRUD.delete"</span><span
class="br0">)</span>
        assertNoErrors<span class="br0">(</span><span class="br0">)</span>
    <span class="br0">}</span>
&nbsp;
    <span class="kw4">void</span> testDoubleClickOnlyInsertsACollectionElement<span
class="br0">(</span><span class="br0">)</span> <span class="kw2">throws</span> <span
class="kw3">Exception</span> <span class="br0">{</span>
        <span class="kw9">execute</span><span class="br0">(</span><span class="st0">"CRUD.new"</span><span
class="br0">)</span>
        setValue<span class="br0">(</span><span class="st0">"customer.number"</span>, <span
class="st0">"1"</span><span class="br0">)</span>
        assertCollectionRowCount<span class="br0">(</span><span class="st0">"details"</span>, <span
class="nu0">0</span><span class="br0">)</span>
        <span class="kw9">execute</span><span class="br0">(</span><span class="st0">"Collection.new"</span>, <span
class="st0">"viewObject=xava_view_details"</span><span class="br0">)</span>
        setValue<span class="br0">(</span><span class="st0">"product.number"</span>, <span
class="st0">"1"</span><span class="br0">)</span>
        setValue<span class="br0">(</span><span class="st0">"quantity"</span>, <span
class="st0">"10"</span><span class="br0">)</span>
        HtmlElement action <span class="sy0">=</span> getForm<span class="br0">(</span><span
class="br0">)</span>.<span class="me1">getElementById</span><span class="br0">(</span>decorateId<span
class="br0">(</span><span class="st0">"Collection.save"</span><span class="br0">)</span><span
class="br0">)</span>
&nbsp;
        action.<span class="me1">click</span><span class="br0">(</span><span class="br0">)</span> <span
class="co1">// Not dblClick(), it does not reproduce the problem</span>
        action.<span class="me1">click</span><span class="br0">(</span><span class="br0">)</span>
        <span class="kw3">Thread</span>.<span class="me1">sleep</span><span class="br0">(</span><span
class="nu0">3000</span><span class="br0">)</span>
&nbsp;
        assertNoErrors<span class="br0">(</span><span class="br0">)</span>
        assertCollectionRowCount<span class="br0">(</span><span class="st0">"details"</span>, <span
class="nu0">1</span><span class="br0">)</span>
&nbsp;
        <span class="kw9">execute</span><span class="br0">(</span><span class="st0">"CRUD.delete"</span><span
class="br0">)</span>
        assertNoErrors<span class="br0">(</span><span class="br0">)</span>
    <span class="br0">}</span>
&nbsp;
    <span class="kw2">private</span> <span class="kw3">String</span> getNextNumber<span
class="br0">(</span><span class="br0">)</span> <span class="kw2">throws</span> <span
class="kw3">Exception</span> <span class="br0">{</span>
        Query query <span class="sy0">=</span> getManager<span class="br0">(</span><span
class="br0">)</span>.
            <span class="me1">createQuery</span><span class="br0">(</span>
                <span class="st0">"select max(o.number) from Order o where o.year = :year"</span><span
class="br0">)</span>
        query.<span class="me1">setParameter</span><span class="br0">(</span><span
class="st0">"year"</span>, Dates.<span class="me1">getYear</span><span class="br0">(</span><span
class="kw2">new</span> <span class="kw3">Date</span><span class="br0">(</span><span
class="br0">)</span><span class="br0">)</span><span class="br0">)</span>
        <span class="kw3">Integer</span> lastNumber <span class="sy0">=</span> <span
class="br0">(</span><span class="kw3">Integer</span><span class="br0">)</span> query.<span
class="me1">getSingleResult</span><span class="br0">(</span><span class="br0">)</span>
        <span class="kw1">if</span> <span class="br0">(</span>lastNumber <span class="sy0">==</span> <span
class="kw2">null</span><span class="br0">)</span> lastNumber <span class="sy0">=</span> <span
class="nu0">0</span>
        <span class="kw2">return</span> <span class="kw3">Integer</span>.<span class="me1">toString</span><span
class="br0">(</span>lastNumber <span class="sy0">+</span> <span class="nu0">1</span><span
class="br0">)</span>
    <span class="br0">}</span>
&nbsp;
<span class="br0">}</span></pre>
      <h2 id="toc4"><a name="Groovy-Ojo con las anotaciones anidadas"></a>Ojo
        con las anotaciones anidadas</h2>
      La mayoría de la sintaxis de Java es compatible con Groovy. Sin embargo,
      hay un pequeño detalle de la sintaxis de Groovy que hemos de tener en
      cuenta cuando usamos anotaciones anidadas: hemos de <strong>usar [] en
        vez de {}</strong>, como sigue:<br>
      <style type="text/css"><!--
/**
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 */
.groovy  {font-family:monospace;}
.groovy .imp {font-weight: bold; color: red;}
.groovy .kw1 {color: #b1b100;}
.groovy .kw2 {color: #000000; font-weight: bold;}
.groovy .kw3 {color: #aaaadd; font-weight: bold;}
.groovy .kw4 {color: #993333;}
.groovy .kw5 {color: #663399;}
.groovy .kw6 {color: #CC0099;}
.groovy .kw7 {color: #FFCC33;}
.groovy .kw8 {color: #993399;}
.groovy .kw9 {color: #993399; font-weight: bold;}
.groovy .co1 {color: #808080; font-style: italic;}
.groovy .co2 {color: #a1a100;}
.groovy .co3 {color: #808080; font-style: italic;}
.groovy .coMULTI {color: #808080; font-style: italic;}
.groovy .es0 {color: #000099; font-weight: bold;}
.groovy .br0 {color: #66cc66;}
.groovy .sy0 {color: #66cc66;}
.groovy .st0 {color: #ff0000;}
.groovy .nu0 {color: #cc66cc;}
.groovy .me1 {color: #006600;}
.groovy .me2 {color: #006600;}
.groovy .re0 {color: #0000ff;}
.groovy span.xtra { display:block; }

-->
</style><pre class="groovy">@Views<span class="br0">(</span><span class="br0">[</span> <span
class="co1">// Usa [ en vez de {</span>
    @<span class="kw3">View</span><span class="br0">(</span>members<span class="sy0">=</span><span
class="st0">""" // Usa """</span> para cadenas multilínea
        edificio <span class="br0">[</span>
            nombre, funcion<span class="sy0">;</span>
            direccion
        <span class="br0">]</span>
    <span class="st0">"""),
    @View(name="Simple", members="nombre")
]) // Usa ] en vez de }</span></pre>
      Fíjate como usamos <em>@Views([ ... ])</em> en lugar de <em>@Views({ ...
        })</em>. Fíjate también que podemos usar """ para cadenas multilínea.<br>
      Para más detalles sobre la sintaxis de Groovy lee sobre las <a href="https://groovy-lang.org/differences.html">diferencias
        entre Groovy y Java</a>.</div>
    <div class="wiki" style="display: block;"><br>
    </div>
  </body>
</html>
