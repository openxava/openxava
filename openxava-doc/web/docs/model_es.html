<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>Modelo - OpenXava</title>
    <link rel="stylesheet" href="static/style.css" type="text/css">
    <link rel="stylesheet" href="highlight/highlight.css">
    
    <link rel="stylesheet" href="highlight/highlightjs-copy.css"><script src="highlight/highlight.js"></script>
    
    <script src="highlight/highlightjs-copy.js"></script><script>window.addEventListener('DOMContentLoaded',function(){hljs.addPlugin(new CopyButtonPlugin({ autohide: false }));hljs.highlightAll();});</script>
  </head>
  <body>
    <div class="wiki" id="content_view" style="display: block;">
      <h1 id="toc0"><a name="Modelo"></a> <span id="breadcrumbs"> <span id="openxava">
            <a href="https://www.openxava.org/"> <span>o</span>pen<span>x</span>ava
              </a> </span> / <a href="index_es.html">documentación</a> / </span>
        Modelo</h1>
      <strong>Guía de referencia</strong>: <strong>Modelo</strong> | <a class="wiki_link"

        href="view_es.html">Vista</a> | <a class="wiki_link" href="tab_es.html">Datos
        tabulares</a> | <a class="wiki_link" href="mapping_es.html">Mapeo
        objeto/relacional</a> | <a class="wiki_link" href="controllers_es.html">Controladores</a>
      | <a class="wiki_link" href="application_es.html">Aplicación</a> | <a class="wiki_link"

        href="customizing_es.html">Personalización</a>
      <hr>
      <div id="toc">
        <h1 class="nopad">Tabla de contenidos</h1>
        <div style="margin-left: 1em;"><a href="#Modelo">Modelo</a></div>
        <div style="margin-left: 2em;"><a href="#Modelo-Componente%20de%20negocio">Componente
            de negocio</a></div>
        <div style="margin-left: 2em;"><a href="#Modelo-Entidad">Entidad</a></div>
        <div style="margin-left: 2em;"><a href="#Modelo-Clases%20incrustables%20%28Embeddable%29">Clases
            incrustables (Embeddable)</a></div>
        <div style="margin-left: 2em;"><a href="#Modelo-Propiedades">Propiedades</a></div>
        <div style="margin-left: 3em;"><a href="#Modelo-Propiedades-Estereotipo">Estereotipo</a></div>
        <div style="margin-left: 3em;"><a href="#Modelo-Propiedades-Estereotipo%20GALERIA_IMAGENES">Estereotipo
            GALERIA_IMAGENES</a></div>
        <div style="margin-left: 3em;"><a href="#archivos">Archivo (nuevo en
            v5.0) y archivos (nuevo en v5.1)<br>
          </a></div>
        <div style="margin-left: 4em;"><a href="#Modelo-Propiedades-Estereotipos%20ARCHIVO%20%28nuevo%20en%20v5.0%29//%20y%20ARCHIVOS%20//%28nuevo%20en%20v5.1%29-Almacenamiento%20en%20el%20Sistema%20de%20Archivos">Almacenamiento
            en el Sistema de Archivos</a></div>
        <div style="margin-left: 4em;"><a href="#Modelo-Propiedades-Estereotipos%20ARCHIVO%20%28nuevo%20en%20v5.0%29//%20y%20ARCHIVOS%20//%28nuevo%20en%20v5.1%29-Almacenamiento%20en%20Base%20de%20Datos">Almacenamiento
            en Base de Datos</a></div>
        <div style="margin-left: 4em;"><a href="#manipular-archivos-por-codigo">Manipular
            los archivos por código</a></div>
        <div style="margin-left: 3em;"><a href="#discusion">Discusion (nuevo en
            v5.6)</a></div>
        <div style="margin-left: 3em;"><a href="#coordenadas">Coordenadas (nuevo
            en v6.6)</a></div>
        <div style="margin-left: 3em;"><a href="#firma-manuscrita">Firma manuscrita (nuevo en
            v7.6)</a></div>
        <div style="margin-left: 3em;"><a href="#mascaras">Máscara (nuevo en
            v7.1)<br>
          </a></div>
        <div style="margin-left: 3em;"><a href="#Modelo-Propiedades-Concurrencia+y+propiedad+version">Concurrencia
            y propiedad versión</a></div>
        <div style="margin-left: 3em;"><a href="#Modelo-Propiedades-Enums">Enums</a></div>
        <div style="margin-left: 3em;"><a href="#enums-con-icono">Enums con
            icono (nuevo en v6.3)</a></div>
        <div style="margin-left: 3em;"><a href="#Modelo-Propiedades-Propiedades%20calculadas">Propiedades
            calculadas</a></div>
        <div style="margin-left: 3em;"><a href="#Modelo-Propiedades-Formula%20%28nuevo%20en%20v3.1.4%29">Fórmula
            (nuevo en v3.1.4)</a></div>
        <div style="margin-left: 3em;"><a href="#Modelo-Propiedades-Calculador%20valor%20por%20defecto">Calculador
            valor por defecto</a></div>
        <div style="margin-left: 3em;"><a href="#Modelo-Propiedades-Valores%20por%20defecto%20al%20crear">Valores
            por defecto al crear</a></div>
        <div style="margin-left: 3em;"><a href="#Modelo-Propiedades-Validador%20de%20propiedad">Validador
            de propiedad</a></div>
        <div style="margin-left: 3em;"><a href="#Modelo-Propiedades-Validador%20por%20defecto%20%28nuevo%20en%20v2.0.3%29">Validador
            por defecto (nuevo en v2.0.3)</a></div>
        <div style="margin-left: 3em;"><a href="#Modelo-Propiedades-Calculo+%28nuevo+en+v5.7%29">Cálculo
            (nuevo en v5.7)</a></div>
        <div style="margin-left: 2em;"><a href="#Modelo-Referencias">Referencias</a></div>
        <div style="margin-left: 3em;"><a href="#Modelo-Referencias-Calculador%20valor%20por%20defecto%20en%20referencias">Calculador
            valor por defecto en referencias</a></div>
        <div style="margin-left: 3em;"><a href="#Modelo-Referencias-Usar%20referencias%20como%20clave">Usar
            referencias como clave</a></div>
        <div style="margin-left: 3em;"><a href="#Modelo-Referencias-Referencias%20incrustadas">Referencias
            incrustadas</a></div>
        <div style="margin-left: 2em;"><a href="#Modelo-Colecciones">Colecciones</a></div>
        <div style="margin-left: 3em;"><a href="#Modelo-Colecciones-Colecciones%20de%20entidades">Colecciones
            de entidades</a></div>
        <div style="margin-left: 3em;"><a href="#colecciones-con-condicion">Colecciones
            con condición</a></div>
        <div style="margin-left: 3em;"><a href="#colecciones-calculadas">Colecciones
            calculadas</a></div>
        <div style="margin-left: 3em;"><a href="#colecciones-muchos-a-muchos">Colecciones
            muchos-a-muchos</a></div>
        <div style="margin-left: 3em;"><a href="#Modelo-Colecciones-Colecciones%20incrustadas">Colecciones
            incrustadas</a></div>
        <div style="margin-left: 3em;"><a href="#Modelo-Colecciones-Colecciones%20de%20elementos%20%28nuevo%20en%20v5.0%29">Colecciones
            de elementos (nuevo en v5.0)</a></div>
        <div style="margin-left: 3em;"><a href="#Modelo-Colecciones-Listas%20con%20@OrderColumn%20%28nuevo%20en%20v5.3%29">Listas
            con @OrderColumn (nuevo en v5.3)</a></div>
        <div style="margin-left: 2em;"><a href="#Modelo-M%C3%A9todos">Métodos</a></div>
        <div style="margin-left: 2em;"><a href="#Modelo-Buscadores">Buscadores</a></div>
        <div style="margin-left: 2em;"><a href="#Modelo-Validador%20de%20entidad">Validador
            de entidad</a></div>
        <div style="margin-left: 2em;"><a href="#Modelo-Validador%20al%20borrar">Validador
            al borrar</a></div>
        <div style="margin-left: 2em;"><a href="#Modelo-Metodos+de+retrollamada+de+JPA">Métodos
            de retrollamada de JPA</a></div>
        <div style="margin-left: 2em;"><a href="#Modelo-Metodos+de+retrollamada+de+OX+%28nuevo+en+v4.0.1%29">Métodos
            de retrollamada de OX (nuevo en v4.0.1)</a></div>
        <div style="margin-left: 2em;"><a href="#Modelo-Herencia">Herencia</a></div>
        <div style="margin-left: 2em;"><a href="#Modelo-Clave+multiple">Clave
            múltiple</a></div>
        <div style="margin-left: 3em;"><a href="#Modelo-Clave+multiple-Clase+id">Clase
            id</a></div>
        <div style="margin-left: 3em;"><a href="#Modelo-Clave+multiple-Id+inscrustado">Id
            inscrustado</a></div>
        <div style="margin-left: 2em;"><a href="#Modelo-Bean%20Validation">Bean
            Validation</a></div>
        <div style="margin-left: 3em;"><a href="#Modelo-Bean%20Validation-@AssertTrue">@AssertTrue</a></div>
        <div style="margin-left: 2em;"><a href="#Modelo-Hibernate%20Validator%20%28nuevo%20en%20v3.0.1%29">Hibernate
            Validator (nuevo en v3.0.1)</a></div>
      </div>
      La capa del modelo en una aplicación orientada a objetos es la que
      contiene la lógica de negocio, esto es la estructura de los datos con los
      que se trabaja y todos los cálculos, validaciones y procesos asociados a
      esos datos.<br>
      OpenXava es un marco orientado al modelo, en donde el modelo es lo más
      importante, y todo lo demás (p. ej. la interfaz gráfica) depende de él.<br>
      La forma de definir el modelo en OpenXava es mediante simples clases Java<b>
      </b>(aunque también existe una <a class="wiki_link" href="model-xml_es.html">versión
        XML</a>) y un poquito de Java. OpenXava provee una aplicación
      completamente funcional a partir de la definición del modelo.<br>
      <h2 id="toc1"><a name="Modelo-Componente de negocio"></a>Componente de
        negocio</h2>
      La unidad básica para crear aplicaciones OpenXava es el componente de
      negocio. Un componente de negocio se define usando una clase Java llamada
      <em>Entity</em><em>.</em> Esta clase es una entidad EJB3 convencional, o
      con otras palabras, un <a class="wiki_link_ext" href="http://es.wikipedia.org/wiki/Plain_Old_Java_Object"

        rel="nofollow">POJO</a> con anotaciones que sigue el estándar <a class="wiki_link_ext"

        href="http://es.wikipedia.org/wiki/Java_Persistence_API" rel="nofollow">Java
        Persistence API</a> (JPA).<br>
      JPA es el estándar de Java para la persistencia, es decir, para objetos
      que guardan su estado en una base de datos. Si sabes desarrollar usando
      POJOs con JPA, ya sabes como desarrollar aplicaciones OpenXava.<br>
      Usando una simple clase Java podemos definir un Componente de Negocio con:<br>
      <ul>
        <li><strong>Modelo</strong>: Estrutura de datos, validaciones, calculos,
          etc.</li>
        <li><strong><a class="wiki_link" href="view_es.html">Vista</a></strong>:
          Cómo se puede mostrar el modelo al usuario.</li>
        <li><strong><a class="wiki_link" href="tab_es.html">Datos tabulares</a></strong>:
          Cómo se muestra los datos de este componentes en modo lista (en
          formato tabular).</li>
        <li><strong><a class="wiki_link" href="mapping_es.html">Mapeo
              objeto/relacional</a></strong>: Cómo grabar y leer el estado de
          los objetos desde la base de datos.</li>
      </ul>
      Este capítulo explica cómo definir la parte del modelo, es decir, todo
      sobre la estructura, las validaciones, los cálculos, etc.<br>
      <h2 id="toc2"><a name="Modelo-Entidad"></a>Entidad</h2>
      Para definir la parte del modelo hemos de crear una clase Java o <a class="wiki_link"

        href="groovy_es.html">Groovy</a> (desde v4m6) con anotaciones. Además de
      sus propias anotaciones, OpenXava sporta anotaciones de <a class="wiki_link_ext"

        href="http://java.sun.com/javaee/technologies/persistence.jsp" rel="nofollow">JPA</a>,
      <a class="wiki_link_ext" href="http://validator.hibernate.org/" rel="nofollow">Hibernate
        Validator</a> e <a class="wiki_link_ext" href="http://annotations.hibernate.org/"

        rel="nofollow">Hibernate Annotations</a>. Esta clase Java es una
      entidad, es decir, una clase persistente que representa concepto de
      negocio.<br>
      En este capítulo JPA se usa para indicar que es una anotación estándar de
      Java Persistent API, HV para indicar que es una anotación de Hibernate
      Validator, HA para indicar que es una anotación de Hibernate Annotations y
      OX para indicar que es una anotación de OpenXava.<br>
      Ésta es la sintáxis para una entidad:<br>
      <pre><code class="language-java">@<a href="http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+Entity">Entity</a> // 1
@EntityValidator // 2
@RemoveValidator // 3
public class NombreEntidad { // 4
 // Propiedades // 5
 // Referencias // 6
 // Colecciones // 7
 // Métodos // 8
 // Buscadores // 9
 // Métodos de retrollamada // 10
}</code></pre>
      <ol>
        <li><strong>@Entity</strong> (<a class="wiki_link_ext" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/Entity.html"

            rel="nofollow">JPA</a>, uno, obligado): Indica que esta clase es una
          entidad JPA, con otras palabras, sus instancias serán objetos
          persistentes.</li>
        <li><strong><a class="wiki_link" href="#Modelo-Validador%20de%20entidad">@EntityValidator</a></strong>
          (<a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/EntityValidator.html"

            rel="nofollow">OX</a>, varios, opcional): Ejecuta una validación a
          nivel de modelo. Este validador puede recibir el valor de varias
          propiedades del modelo. Para validar una sola propiedad es preferible
          poner el validador a nivel de propiedad.</li>
        <li><strong><a class="wiki_link" href="#Modelo-Validador%20al%20borrar">@RemoveValidator</a></strong>
          (<a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/RemoveValidator.html"

            rel="nofollow">OX</a>, varios, opcional): Se ejecuta antes de
          borrar, y tiene la posibilidad de vetar el borrado del objeto.</li>
        <li><strong>Declaración de la clase</strong>: Como en un clase de Java
          convencional. Podemos usar <em>extends</em> e <em>implements</em>.</li>
        <li><strong><a href="#Modelo-Propiedades">Propiedades</a></strong>:
          Propiedades de Java convencionales. Representan el estado principal
          del objeto.</li>
        <li><strong><a class="wiki_link" href="#Modelo-Referencias">Referencias</a></strong>:
          Referencias a otras entidades o clases incrustables.</li>
        <li><strong><a class="wiki_link" href="#Modelo-Colecciones">Colecciones</a></strong>:
          Colecciones de referencias a otras entidades o clases incrustables.</li>
        <li><strong><a class="wiki_link" href="#Modelo-M%C3%A9todos">Métodos</a></strong>:
          Métodos Java con lógica de negocio.</li>
        <li><strong><a class="wiki_link" href="#Modelo-Buscadores">Buscadores</a></strong>:
          Los buscadores son métodos estáticos que hacen búsquedas usando las
          prestaciones de consulta de JPA.</li>
        <li><strong><a class="wiki_link" href="#Modelo-Metodos+de+retrollamada+de+JPA">Métodos
              de retrollamada</a></strong>: Los métodos JPA de retrollamada (<em>callbacks</em>)
          para insertar lógica al crear, modificar, cargar, borrar, etc</li>
      </ol>
      <h2 id="toc3"><a name="Modelo-Clases incrustables (Embeddable)"></a>Clases
        incrustables (Embeddable)</h2>
      Tal y como indica la especificación JPA:<br>
      <em>"Una entidad puede usar otras clases finamente granuladas para
        representar su estado. Instancias de estas clases, no como en el caso de
        las entidades, no tiene identidad persistente. En vez de eso, existen
        solo como objetos incrustados de una entidad a la que pertenecen. Estos
        objetos incrustados son propiedad exclusiva de sus entidades dueñas, y
        no se comparten entre entidades persistentes."</em><br>
      La sintaxis para una clase incrustada es:<br>
      <pre><code class="language-java">@Embeddable // 1
public class NombreIncrustada { // 2
 // Propiedades // 3
 // Referencias // 4
 // Metodos // 5
}
&nbsp;</code></pre>
      <ol>
        <li><strong>@Embeddable</strong> (<a class="wiki_link_ext" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/Embeddable.html"

            rel="nofollow">JPA</a>, una, requerido): Indica que esta clase es
          una clase incrustada de JPA, en otras palabras, sus instancias serán
          parte de objetos persistente.</li>
        <li><strong>Declaración de la clase</strong>: Como una clase Java
          convencional. Podemos uar <em>extends</em> y <em>implements</em>.</li>
        <li><strong><a href="#Modelo-Propiedades">Propiedades</a></strong>:
          Propiedades Java convencionales.</li>
        <li><a class="wiki_link" href="model_es.html#Cap%C3%ADtulo%203:%20Modelo-Referencias"></a><strong><a

              class="wiki_link" href="#Modelo-Referencias">Referencias</a></strong>:
          Referencias a entidades o clases incrustables.</li>
        <li><strong><a class="wiki_link" href="#Modelo-M%C3%A9todos">Métodos</a></strong>:
          Métodos Java con lógica de negocio.</li>
      </ol>
      <h2 id="toc4"><a name="Modelo-Propiedades"></a>Propiedades</h2>
      Una propiedad representa parte del estado de un objeto que se puede
      consultar y en algunos casos cambiar. El objeto no tiene la obligación de
      guardar físicamente la información de la propiedad, solo de devolverla
      cuando se le pregunte.<br>
      La sintaxis para definir una propiedad es:<br>
      <pre><code class="language-java">@Stereotype                                                                //  1
@Column(length=) @Column(precision=) @Max @Length(max=) @Digits(integer=)  //  2
@Digits(integer=) @Digits(fraction=)                                       //  3
@Required @Min @Range(min=) @Length(min=)                                  //  4
@Id                                                                        //  5
@Hidden                                                                    //  6
@SearchKey                                                                 //  7
@Version                                                                   //  8
@Formula                                                                   //  9  Nuevo en v3.1.4
@Calculation                                                               // 10  Nuevo en v5.7
@DefaultValueCalculator                                                    // 11
@PropertyValidator                                                         // 12
private tipo nombrePropiedad;                                              // 13
public tipo getNombrePropiedad() { ... }                                   // 13
public void setNombrePropiedad(tipo nuevoValor) { ... }                    // 13</code></pre>
      <ol>
        <li><strong><a class="wiki_link" href="#Model-Properties-Stereotype">@Stereotype</a></strong>
          (<a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/Stereotype.html"

            rel="nofollow">OX</a>, opcional): Permite especificar un
          comportamiento especial para cierta propiedades.</li>
        <li><strong>@Column(length=)</strong> (<a class="wiki_link_ext" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/Column.html"

            rel="nofollow">JPA</a>), <strong>@Max</strong> (<a class="wiki_link_ext"

            href="http://docs.jboss.org/hibernate/beanvalidation/spec/1.1/api/javax/validation/constraints/Max.html"

            rel="nofollow">BV</a>), <strong>@Length(max=)</strong> (<a class="wiki_link_ext"

            href="http://docs.jboss.org/hibernate/validator/5.1/api/org/hibernate/validator/constraints/Length.html"

            rel="nofollow">HV</a>), <strong>@Digits(integer=)</strong> (<a class="wiki_link_ext"

            href="http://docs.jboss.org/hibernate/beanvalidation/spec/1.1/api/javax/validation/constraints/Digits.html"

            rel="nofollow">BV</a>): opcional, normalmente solo se usa una):
          Longitud en caracteres de la propiedad, excepto para <em>@Max</em>
          que es el valor máximo. Especialmente útil a la hora de generar
          interfaces gráficas. Si no especificamos longitud asume un valor por
          defecto asociado al tipo o estereotipo que se obtiene de <em>default-size.xml</em>
          o <em>longitud-defecto.xml</em>. <em>@Max</em> y <em>@Digits</em>
          son de Bean Validation <em>(nuevo en v4.1)</em> o de Hibernate
          Validator <em>(hasta v5.2.x)</em>.</li>
        <li><strong>@Column(scale=)</strong> (<a class="wiki_link_ext" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/Column.html"

            rel="nofollow">JPA</a>), <strong>@Digits(fraction=)</strong> (<a class="wiki_link_ext"

            href="http://docs.jboss.org/hibernate/beanvalidation/spec/1.1/api/javax/validation/constraints/Digits.html"

            rel="nofollow">BV</a>): Escala (tamaño de la parte decimal) de la
          propiedad. Sólo aplica a propiedades numéricas. Si no se usa <em>@Column</em>
          o <em>@Digits</em> se asume un valor por defecto, si se usa <em>@Column</em>
          sin <i>length</i>, sin <i>precision</i> y sin <em>scale</em> se
          asume un valor por defecto para <i>scale</i>, si se usa <em>@Column</em>
          con <i>length</i> o <i>precision</i> y sin <em>scale</em> se asume
          0 (<i>nuevo en v7.0.6</i> antes se asumía un valor por defecto), si se
          usa <em>@Digits</em> sin <em>fraction</em> se asume 0. El valor por
          defecto asociado al tipo o estereotipo que se obtiene de <em>default-size.xml</em>
          o <em>longitud-defecto.xml</em>. <em>@Digits</em> es de Bean
          Validation <em>(nuevo en v4.1)</em> o de Hibernate Validator (hasta
          v5.2.x).</li>
        <li><strong>@Required</strong> (<a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/Required.html"

            rel="nofollow">OX</a>), <strong>@Min</strong> (<a class="wiki_link_ext"

            href="http://docs.jboss.org/hibernate/beanvalidation/spec/1.1/api/javax/validation/constraints/Min.html"

            rel="nofollow">BV</a>), <strong>@Range(min=)</strong> (<a class="wiki_link_ext"

            href="http://docs.jboss.org/hibernate/validator/5.1/api/org/hibernate/validator/constraints/Range.html"

            rel="nofollow">HV</a>), <strong>@Length(min=)</strong> (<a class="wiki_link_ext"

            href="http://docs.jboss.org/hibernate/validator/5.1/api/org/hibernate/validator/constraints/Length.html"

            rel="nofollow">HV</a>) (opcional, normalmente solo se usa una):
          Indica si esa propiedad es requerida. En el caso de <em>@Min</em>, <em>@Range</em>
          y <em>@Length</em> tenemos que poner un valor mayor que cero para <em>min</em>
          para que se asuma la propiedad como requerida. Por defecto es true
          para las propiedades clave ocultas <em>(nuevo en v2.1.3)</em> y false
          en todos los demás casos. Al grabar OpenXava comprobará si las
          propiedades requeridas están presentes, si no lo están no se producirá
          la grabación y se devolverá una lista de errores de validación. La
          lógica para determinar si una propiedad está presente o no se puede
          configurar creando un archivo <em>validators.xml</em> o <em>validadores.xml</em>
          en nuestro proyecto. Podemos ver la sintaxis en <a href="https://github.com/openxava/openxava/blob/master/openxava/src/main/resources/xava/default-validators.xml"><em>openxava/src/main/resources/xava/default-validators.xml</em></a>.
          <em>@Required</em> y <em>@Min</em> son restricciones de <a class="wiki_link"

            href="model_es.html#Modelo-Bean%20Validation">Bean Validation</a>
          desde v5.3 y eran restricciones de <a class="wiki_link" href="model_es.html#Modelo-Hibernate%20Validator%20%28nuevo%20en%20v3.0.1%29">Hibernate
            Validator</a> hasta v5.2.x<span class="wiki_link"><em>.</em></span></li>
        <li><strong>@Id</strong> (<a class="wiki_link_ext" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/Id.html"

            rel="nofollow">JPA</a>, opcional): Para indicar si una propiedad
          forma parte de la clave. Al menos una propiedad (o referencia) ha de
          ser clave. La combinación de propiedades (y referencias) clave se debe
          mapear a un conjunto de campos en la base de datos que no tengan
          valores repetidos, típicamente con la clave primaria.</li>
        <li><strong>@Hidden</strong> (<a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/Hidden.html"

            rel="nofollow">OX</a>, opcional): Una propiedad oculta es aquella
          que tiene sentido para el desarrollador pero no para el usuario. Las
          propiedades ocultas se excluyen cuando se generan interfaces gráficas
          automáticas, sin embargo a nivel de código generado están presentes y
          son totalmente funcionales, incluso si se les hace alusión explicita
          podrían aparecer en una interfaz gráfica.</li>
        <li><strong>@SearchKey</strong> (<a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/SearchKey.html"

            rel="nofollow">OX</a>, optional): Las propiedades clave de búsqueda
          se usan por los usuarios para buscar los objetos. Son editables en la
          interfaz de usuario de las referencias permitiendo al usuario teclear
          su valor para buscar. OpenXava usa las propiedades clave (<em>@Id</em>)
          para buscar por defecto, y si la propiedades clave (<em>@Id</em>)
          están ocultas usa la primera propiedad en la vista. Con <em>@SearchKey</em>
          podemos elegir las propiedades para buscar explicitamente.</li>
        <li><strong></strong><strong><a class="wiki_link" href="#Modelo-Propiedades-Concurrencia+y+propiedad+version">@Version</a></strong>
          (<a class="wiki_link_ext" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/Version.html"

            rel="nofollow">JPA</a>, opcional): Una propiedad versión se usa para
          el control de concurrencia optimista. Si queremos control de
          concurrencia solo necesitamos tener una propiedad marcada como <em>@Version</em>
          en nuestra entidad. Solo podemos especificar una propiedad de versión
          por entidad. Los siguientes tipos son soportados para propiedades
          versión: <em>int, Integer, short, Short, long, Long, Timestamp</em>.
          Las propiedades de versión también se consideran ocultas.</li>
        <li><strong><a class="wiki_link" href="#Modelo-Propiedades-Formula%20%28nuevo%20en%20v3.1.4%29">@Formula</a></strong>
          (<a class="wiki_link_ext" href="http://docs.jboss.org/hibernate/stable/annotations/api/org/hibernate/annotations/Formula.html"

            rel="nofollow">HA</a>, opcional): <em>(Nuevo en v3.1.4)</em> Para
          calcular el valor de la propiedad usando la base de datos. Tiene que
          ser un fragmento válido de SQL.</li>
        <li><strong><a class="wiki_link" href="model_es.html#Modelo-Propiedades-C%C3%A1lculo%20%28nuevo%20en%20v5.7%29">@Calculation</a></strong>
          (<a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/Calculation.html"

            rel="nofollow">OX</a>, uno, opcional): <em>(Nuevo en v5.7)</em>
          Expresión aritmética para calcular el valor de la propiedad. El
          cálculo se hace en la interfaz de usuario cuando alguno de los
          operandos cambia.</li>
        <li><strong><a class="wiki_link" href="#Modelo-Propiedades-Calculador%20valor%20por%20defecto">@DefaultValueCalculator</a></strong>
          (<a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/DefaultValueCalculator.html"

            rel="nofollow">OX</a>, uno, optional): Para implementar la lógica
          para calcular el valor inicial de la propiedad. Una propiedad con <em>@DefaultValueCalculator</em>
          sí tiene <em>setter</em> y es persistente.</li>
        <li><strong><a class="wiki_link" href="#Modelo-Propiedades-Validador%20de%20propiedad">@PropertyValidator</a></strong>
          (<a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/PropertyValidator.html"

            rel="nofollow">OX</a>, varios, opcional): Indica la lógica de
          validación a ejecutar sobre el valor a asignar a esta propiedad antes
          de crear o modificar.</li>
        <li><strong>Declaración de la propiedad</strong>: Una declaración de
          propiedad Java normal y corriente con <em>getters</em> y <em>setters</em>.
          Podemos crear una propiedad calculada usando solo un <em>getter</em>
          sin campo ni <em>setter</em>. Cualquier tipo legal para JPA está
          permitido, solo hemos de proveer un <em>Hibernate Type</em> para
          grabar en la base de datos y un editor OpenXava para dibujar como
          HTML.</li>
      </ol>
      <h3 id="toc5"><a name="Modelo-Propiedades-Estereotipo"></a>Estereotipo</h3>
      Un estereotipo (<em><a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/Stereotype.html"

          rel="nofollow">@Stereotype</a></em>) es la forma de determinar un
      comportamiento especifico dentro de un tipo. Por ejemplo, un nombre, un
      comentario, una descripción, etc. todos corresponden al tipo Java
      java.lang.String pero si queremos que los validadores, logitud por
      defecto, editores visuales, etc. sean diferente en cada caso y necesitamos
      afinar más; lo podemos hacer asignando un esterotipo a cada uno de estos
      casos. Es decir, podemos tener los estereotipos NOMBRE, TEXTO_GRANDE o
      DESCRIPCION y asignarlos a nuestras propiedades.</div>
    <div class="wiki" style="display: block;">A partir de v6.6 puedes usar
      anotaciones Java específicas en lugar de estereotipos (es decir puedes
      usar <i>@File</i> en lugar de <i>@Stereotype("ARCHIVO")</i>), así el
      compilador asegura que el código está bien escrito y además se pueden usar
      atributos específicos para cada anotación.</div>
    <div class="wiki" style="display: block;"> El OpenXava viene configurado con
      los siguientes estereotipos y a partir de v6.6 con su anotación
      correspondiente:<br>
      <ul>
        <li><i><a href="https://openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/Money.html">@Money</a>
            (</i><i><i>nuevo en </i>v6.6), </i>DINERO, MONEY</li>
        <li>FOTO, PHOTO, IMAGEN, IMAGE (a partir de v6.6 puedes usar <i>@File</i>
          como alternativa que es más flexible y con mayor rendimiento)</li>
        <li><i><a href="https://openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/TextArea.html">@TextArea</a>
            (</i><i><i><i>nuevo en </i></i>v6.6), </i>TEXTO_GRANDE, MEMO,
          TEXT_AREA</li>
        <li><i><a href="https://openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/Label.html">@Label</a>
            (</i><i><i><i>nuevo en </i></i>v6.6), </i>ETIQUETA, LABEL</li>
        <li>ETIQUETA_NEGRITA, BOLD_LABEL</li>
        <li><i><a href="https://openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/StringTime.html">@StringTime</a>
            (</i><i><i><i>nuevo en </i></i>v6.6), </i>HORA, TIME (a partir de
          v7.3 puedes usar propiedades tipo <i>LocalTime</i> en lugar de <i>String</i>,
          cuenta con un editor más sofisticado y mapea a un dato tipo HORA en la
          base de datos)</li>
        <li><i><a href="https://openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/DateTime.html">@DateTime</a>
            (</i><i><i><i>nuevo en </i></i>v6.6), </i>FECHAHORA, DATETIME (a
          partir de v7.4 puedes usar propiedades con tipo <i>LocalDateTime</i>
          en lugar de <i>Date </i>con <i>@DateTime/@Stereotype("FECHAHORA")</i>)</li>
        <li>GALERIA_IMAGENES, IMAGES_GALLERY (<a class="wiki_link" href="#Modelo-Propiedades-Estereotipo%20GALERIA_IMAGENES">instrucciones</a>)
          (a partir de v6.6 puedes usar <i>@File</i>s como alternativa)</li>
        <li><i><a href="https://openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/ZerosFilled.html">@ZerosFilled</a>
            (nuevo en v7.1), </i>RELLENADO_CON_CEROS, ZEROS_FILLED</li>
        <li><i><a href="https://openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/HtmlText.html">@HtmlText</a>
            (</i><i><i><i>nuevo en </i></i>v6.6), </i>TEXTO_HTML, HTML_TEXT
          (texto con formato editable)</li>
        <li><i><a href="https://openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/HtmlText.html">@HtmlText(simple=true)</a>
            (</i><i><i><i>nuevo en </i></i>v6.6), </i>TEXTO_HTML_SIMPLE,
          SIMPLE_HTML_TEXT (<em>nuevo en v5.6</em>, como TEXT_HTML pero con una
          interfaz simplificada)</li>
        <li>ETIQUETA_IMAGEN, IMAGE_LABEL (imagen que depende del contenido de la
          propiedad)</li>
        <li><i>@Email</i> (de <i>javax.validation.constraints</i>) <i>(</i><i><i><i>nuevo
                en </i></i>v6.6)</i>, EMAIL</li>
        <li><i><a href="https://openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/Telephone.html">@Telephone</a>
            (nuevo en v6.6), </i>TELEFONO, TELEPHONE</li>
        <li><i>@URL</i> (de <i>org.hibernate.validator.constraints</i>) <i>(</i><i><i><i>nuevo
                en </i></i>v6.6), </i>WEBURL</li>
        <li><i><a href="https://openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/IP.html">@IP</a>
            (nuevo en v6.6), </i>IP</li>
        <li><i>@ISBN</i> (de <i>org.hibernate.validator.constraints</i>) <i>(nuevo
            en v6.6), </i>ISBN</li>
        <li><i>@CreditCardNumber</i> (from <i>org.hibernate.validator.constraints</i>)
          <i>(nuevo en v6.6), </i>TARJETA_CREDITO, CREDIT_CARD</li>
        <li><i><a href="https://openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/EmailList.html">@EmailList</a>
            (nuevo en v6.6), </i>LISTA_EMAIL, EMAIL_LIST</li>
        <li>LIBRERIA_DOCUMENTOS, DOCUMENT_LIBRARY (<em>nuevo en v4m6</em>, <i>hasta
            v6.6.3</i>, sólo funciona dentro de Liferay)</li>
        <li><i><a href="https://openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/Password.html">@Password</a>
            (nuevo en v6.6), </i>CONTRASENA, PASSWORD (<em>nuevo en v4.1</em>)</li>
        <li><i><a href="https://openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/MAC.html">@MAC</a>
            (new in v6.6), </i>MAC <em>(nuevo en v4.8)</em></li>
        <li><i><a href="https://openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/File.html">@File</a>
            (</i><i><i><i>nuevo en </i></i>v6.6)</i>, ARCHIVO, FILE (<em>nuevo
            en v5.0</em>) (<a class="wiki_link" href="#archivos">instrucciones</a>)</li>
        <li><i><a href="https://openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/Files.html">@Files</a>
            (</i><i><i><i>nuevo en </i></i>v6.6), </i>ARCHIVOS, FILES (<em>nuevo
            en v5.1</em>) (<a class="wiki_link" href="#archivos">instrucciones</a>)</li>
        <li><i><a href="https://openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/Icon.html">@Icon</a>
            (</i><i><i><i>nuevo en </i></i>v6.6), </i>ICONO, ICON (<em>nuevo
            en v5.5</em>)</li>
        <li><i><a href="https://openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/Discussion.html">@Discussion</a>
            (</i><i><i><i>nuevo en </i></i>v6.6), </i>DISCUSION, DISCUSSION <em>(nuevo
            en v5.6)</em> (<a class="wiki_link" href="#discusion">instrucciones</a>)</li>
        <li><i><a href="https://openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/Coordinates.html">@Coordinates</a>,
          </i>COORDENADAS, COORDINATES (<i>nuevo en v6.6</i>) (<a class="wiki_link"

            href="#coordenadas">instrucciones</a>)</li>
        <li><i>@HandwrittenSignature, </i>FIRMA_MANUSCRITA, HANDWRITTEN_SIGNATURE (<i>nuevo en v7.6</i>) (<a class="wiki_link"
            href="#firma-manuscrita">instrucciones</a>)</li>
      </ul>
      Aparte de las anotaciones estilo estereotipo de arriba puedes anotar tus
      propiedades con <a href="view_es.html#Vista-Personalizacion+de+propiedad">anotaciones
        relacionadas con la vista</a>.</div>
    <div class="wiki" style="display: block;"> Vamos a ver como definiríamos un
      estereotipo propio. Crearemos uno llamado NOMBRE_PERSONA para representar
      nombres de persona.<br>
      Editamos (o creamos) el archivo <em>editors.xml</em> o <em>editores.xml</em>
      en nuestra carpeta <i>src/main/resources/xava</i> (simplemente <em>xava</em>
      antes de v7) Y añadimos<br>
      <pre><code class="language-xml">&lt;editor url="editorNombrePersona.jsp"&gt;
    &lt;para-estereotipo estereotipo="NOMBRE_PERSONA"/&gt;
    &lt;para-anotacion anotacion="com.tuempresa.tuaplicacion.anotaciones.NombrePersona"/&gt; &lt;!-- Nuevo en v6.6 --&gt;
&lt;/editor&gt;
</code></pre> De esta forma indicamos que editor se ha de ejecutar para editar y
      visualizar propiedades con el estereotipo NOMBRE_PERSONA. Fíjate como
      desde v6.6 puedes usar una anotación en lugar de un estereotipo, o usar
      ambas cosas.<br>
      Además es útil indicar la longitud por defecto, eso se hace editando <em>default-size.xml</em>
      o <em>longitud-defecto.xml</em>:<br>
      <pre><code class="language-xml">&lt;para-estereotipo nombre="NOMBRE_PERSONA" longitud="40"/&gt;
&lt;para-anotacion clase="com.tuempresa.tuaplicacion.anotaciones.NombrePersona" longitud="40"/&gt; &lt;!-- Nuevo en v6.6 --&gt;
</code></pre> Y así si no ponemos longitud asumirá 40 por defecto.<br>
      Menos común es querer cambiar el validador para requerido, pero si
      queremos cambiarlo lo podemos hacer añadiendo a <em>validators.xml</em> o
      <em>validadores.xml</em> de nuestro proyecto lo siguiente:<br>
      <pre><code class="language-xml">&lt;validador-requerido&gt;
    &lt;clase-validador clase="org.openxava.validators.NotBlankCharacterValidator"/&gt;
    &lt;para-estereotipo estereotipo="NOMBRE_PERSONA"/&gt;
    &lt;para-anotacion anotacion="com.tuempresa.tuaplicacion.anotaciones.NombrePersona"/&gt; &lt;!-- Nuevo en v6.6 --&gt;
&lt;/validador-requerido&gt;
</code></pre> Ahora podemos definir propiedades con estereotipo NOMBRE_PERSONA:<br>
      <pre><code class="language-java">@Stereotype("NOMBRE_PERSONA")
private String nombre;
</code></pre> En este caso asume 40 longitud y tipo <em>String</em>, así como
      ejecutar el validador <em>NotBlankCharacterValidator</em><br>
      para comprobar que es requerido.</div>
    <div class="wiki" style="display: block;"><br>
    </div>
    <div class="wiki" style="display: block;">A partir de v6.6 puedes usar una
      anotación Java en lugar de un estereotipo, de esta forma:</div>
    <div class="wiki" style="display: block;">
      <pre><code class="language-java">@NombrePersona
private String nombre;
</code></pre> </div>
    <div class="wiki" style="display: block;">Obviamente has de escribir el
      código para la anotación <i>@NombrePersona</i>. Echa un vistazo a la <a

        href="customizing_es.html#editores-para-anotaciones">documentación de
        personalización</a>. para aprender más sobre como definir tus propias
      anotaciones.
      <h3 id="toc6"><a name="Modelo-Propiedades-Estereotipo GALERIA_IMAGENES"></a>Estereotipo
        GALERIA_IMAGENES</h3>
      <i>A partir de v6.6 puedes usar <a href="#archivos">@Files</a> en su
        lugar porque ahora @Files muestra una vista previa de los archivos
        subidos. @Files tiene más opciones que GALERIA_IMAGENES y permite varios
        mecanismos de persistencia.</i></div>
    <div class="wiki" style="display: block;"> Si queremos que una propiedad de
      nuestro componente almacene una galería de imágenes. Solo necesitamos
      declarar que nuestra propiedad sea del estereotipo GALERIA_IMAGENES. De
      esta manera:<br>
      <pre><code class="language-java">@Stereotype("GALERIA_IMAGENES")
private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> fotos;</code></pre>
      Además, en el mapeo tenemos que mapear la propiedad contra una columna
      adecuada para almacenar una cadena (String) con 32 caracteres de longitud
      (VARCHAR(32)).<br>
      Y ya está todo.<br>
      Pero, para que nuestra aplicación soporte este estereotipo necesitamos
      configurar nuestro sistema.<br>
      Lo primero es crear a tabla en la base de datos para almacenar las
      imágenes:<br>
      <pre><code class="language-sql">CREATE TABLE IMAGENES (
 ID VARCHAR(32) NOT NULL PRIMARY KEY,
 GALLERY VARCHAR(32) NOT NULL,
 IMAGE BLOB);
CREATE INDEX IMAGENES01
 ON IMAGENES (GALLERY);
&nbsp;</code></pre>
      El tipo de la columna IMAGE puede ser un tipo más adecuado para almacenar
      byte [] en el caso de nuestra base de datos (por ejemplo LONGVARBINARY) .<br>
      Verifica que <em>persistence.xml</em> contiene la entidad <em>GalleryImage</em>,
      si no añádela:<br>
      <div class="wiki">
        <pre><code class="language-xml">&lt;persistence-unit name="default"&gt;
 &lt;provider&gt;org.hibernate.ejb.HibernatePersistence&lt;/provider&gt;
 &lt;non-jta-data-source&gt;java:comp/env/jdbc/OpenXavaTestDS&lt;/non-jta-data-source&gt;
 &lt;class&gt;org.openxava.session.GalleryImage&lt;/class&gt; &lt;!-- AÑADE ESTA LÍNEA --&gt;
 &lt;class&gt;org.openxava.web.editors.DiscussionComment&lt;/class&gt; 
  ...
&lt;/persistence-unit&gt;
&nbsp;</code></pre>
        Fíjate que hemos añadido <em>&lt;class&gt;org.openxava.session.GalleryImage&lt;/class&gt;</em>.</div>
      Si usas una versión de OpenXava anterior a 7.0 necesitas definir el mapeo
      en tu archivo <em>persistence/hibernate.cfg.xml</em>, así:<br>
      <pre><code class="language-xml">&lt;hibernate-configuration&gt;
 &lt;session-factory&gt;
 ...
 &lt;mapping resource="GalleryImage.hbm.xml"/&gt;
 ...
 &lt;/session-factory&gt;
&lt;/hibernate-configuration&gt;</code></pre>
      Después de todo esto ya podemos usar el estereotipo GALERIA_IMAGENES en
      los componentes de nuestra aplicación.<br>
      <h3 id="archivos">Archivo <em>(nuevo en v5.0)</em> y archivos <em>(nuevo
          en v5.1)</em><em><br>
        </em></h3>
      Si queremos que una propiedad de nuestro componente adjunte un archivo,
      sólo necesitamos declarar una propiedad con la anotación <i>@File (nuevo
        en v6.6)</i>. De esta manera:</div>
    <div class="wiki" style="display: block;">
      <pre><code class="language-java">@File
@Column(length=32)
private String documento;
</code></pre> </div>
    <div class="wiki" style="display: block;">O con el estereotipo ARCHIVO si
      usas una versión anterior a la 6.6. Así:<br>
      <pre><code class="language-java">@Stereotype("ARCHIVO")
@Column(length=32)
private String documento;
</code></pre>Usa <i>@Files (nuevo en v6.6)</i> para adjuntar múltiples
      archivos:</div>
    <div class="wiki" style="display: block;">
      <pre><code class="language-java">@Files
@Column(length=32)
private String documentos;
</code></pre> </div>
    <div class="wiki" style="display: block;">O el estereotipo ARCHIVOS si usas
      una versión anterior a la 6.6. Así:</div>
    <div class="wiki" style="display: block;">
      <pre><code class="language-java">@Stereotype("ARCHIVOS")
@Column(length=32)
private String documentos;
</code></pre>Cuando usas la versión con anotación (<i>@File</i> o <i>@Files</i>)
      puedes definir atributos como <i>acceptFileTypes</i> o <i>maxFileSizeInKb
        </i>para restringir los archivos que el usuario puede subir. Por
      ejemplo, con este código:
      <div class="wiki" style="display: block;">
        <pre><code class="language-java">@File(acceptFileTypes="image/*", maxFileSizeInKb=90)
@Column(length=32)
private String foto;
</code></pre> </div>
      <div class="wiki" style="display: block;">El usuario sólo puede subir
        imágenes de 90 Kb o menos, y con este otro:</div>
      <div class="wiki" style="display: block;">
        <pre><code class="language-java">@Files(acceptFileTypes="text/csv, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet")
@Column(length=32)
private String hojasCalculo;
</code></pre> </div>
      <div class="wiki" style="display: block;">Sólo CSV y archivos Excel. Como
        puedes ver en <i>acceptFileTypes</i> pones una <a href="https://docs.w3cub.com/http/basics_of_http/mime_types/complete_list_of_mime_types">lista
          de tipos mime</a> separada por comas y puedes usar asteriscos.</div>
    </div>
    <div class="wiki" style="display: block;"><br>
    </div>
    <div class="wiki" style="display: block;"> OpenXava puede almacenar los
      archivos en <em>base de datos</em> o en <em>el sistema de archivos</em>.<br>
      <h4 id="toc8"><a name="Modelo-Propiedades-Estereotipos ARCHIVO (nuevo en v5.0)// y ARCHIVOS //(nuevo en v5.1)-Almacenamiento en el Sistema de Archivos"></a><strong>Almacenamiento
          en el Sistema de Archivos</strong></h4>
      Éste es por defecto y no requiere de configuraciones adicionales.<br>
      El directorio de almacenamiento es <strong>$HOME/oxfiles</strong>
      (GNU/Linux) o <strong>%USERPROFILE%\oxfiles</strong> (Windows). Podemos
      configurar un directorio diferente mediante la propiedad <strong><em>filesPath</em></strong>
      en <strong><em>xava.properties</em></strong>.<br>
      <h4 id="toc9"><a name="Modelo-Propiedades-Estereotipos ARCHIVO (nuevo en v5.0)// y ARCHIVOS //(nuevo en v5.1)-Almacenamiento en Base de Datos"></a><strong>Almacenamiento
          en Base de Datos</strong></h4>
      Debemos realizar tres configuraciones adicionales:<br>
      <ul>
        <li>Configurar en <strong><em>xava.properties</em></strong> de nuestro
          proyecto la propiedad <strong><em>filePersistorClass</em></strong>.</li>
      </ul>
      <pre><code class="language-text">filePersistorClass=org.openxava.web.editors.JPAFilePersistor
...</code></pre>
      <ul>
        <li>Modificar el <strong><em>persistence.xml</em></strong> de nuestro
          proyecto.</li>
      </ul>
      <pre><code class="language-xml">&lt;persistence-unit name="default"&gt;
 &lt;provider&gt;org.hibernate.ejb.HibernatePersistence&lt;/provider&gt;
 &lt;non-jta-data-source&gt;java:comp/env/jdbc/OpenXavaTestDS&lt;/non-jta-data-source&gt;
 &lt;class&gt;org.openxava.session.GalleryImage&lt;/class&gt;
 &lt;class&gt;org.openxava.web.editors.AttachedFile&lt;/class&gt;
  ...
&lt;/persistence-unit&gt;
&nbsp;
        ...
&nbsp;
&lt;persistence-unit name="junit"&gt;
 &lt;provider&gt;org.hibernate.ejb.HibernatePersistence&lt;/provider&gt;
 &lt;class&gt;org.openxava.web.editors.AttachedFile&lt;/class&gt;
 ....
&lt;/persistence-unit&gt;</code></pre>
      Observa que hemos añadido <strong><em>&lt;class&gt;org.openxava.web.editors.AttachedFile&lt;/class&gt;</em></strong>
      a ambas unidades de persistencia.<br>
      <ul>
        <li>Al generar nuestra base de datos se creará la tabla OXFILES:</li>
      </ul>
      <pre><code class="language-sql">CREATE TABLE OXFILES (
 ID VARCHAR(32) NOT NULL PRIMARY KEY,
 NAME VARCHAR(255),
 DATA LONGVARBINARY,
 LIBRARYID VARCHAR(32)
);</code></pre>
      Debemos verificar que el tipo de la columna DATA sea el tipo más adecuado
      para almacenar byte[] (en nuestro caso LONGVARBINARY).</div>
    <div class="wiki" style="display: block;">
      <h4 id="manipular-archivos-por-codigo">Manipular los archivos por código</h4>
      <p>Las propiedades anotadas con <i>@File</i>, <i>@Files</i>, <i>@HandwrittenSignature</i>, 
        <i>Stereotype("ARCHIVO")</i>, <i>Stereotype("ARCHIVOS")</i> o <i>Stereotype("FIRMA_MANUSCRITA")</i>
        solo almacenan un identificador de 32 caracteres, no almacenan el contenido del archivo. Para acceder desde tu
        propio código al contenido del archivo subido has de usar un <i> <a href="https://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/web/editors/IFilePersistor.html">IFilePersistor</a></i>
        que se obtiene desde <a href="https://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/web/editors/FilePersistorFactory.html"><i>FilePersistorFactory</i></a>,
        clases que puedes encontrar en el paquete <i><a href="https://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/web/editors/package-summary.html">org.openxava.web.editors</a></i>.
        Estas clases funcionan igual no importa si los archivos se guardan en el
        sistema de archivos, una base de datos o cualquier otro sitio.</p>
      <p>En el caso de <i>@File</i>, <i>@HandwrittenSignature</i>, <i>@Stereotype("ARCHIVO")</i> o 
        <i>@Stereotype("FIRMA_MANUSCRITA")</i> la propiedad guarda directamente el id del archivo. 
        Por ejemplo si tenemos una propiedad como esta:</p>
      
      <pre><code class="language-java">@File @Column(length=32)
String foto;
</code></pre>
      <p></p>
      <p>Podemos llenarla con un archivo usando nuestro propio código así:</p>
      <pre><code class="language-java">import java.nio.file.*;

import org.openxava.actions.*;
import org.openxava.web.editors.*;

public class CargarFoto extends ViewBaseAction {

    public void execute() throws Exception {
        // En este ejemplo obtenemos el archivos del sistema de archivos
        // pero en tu caso puedes obtener el archivo desde cualquier otro sitio
        String filePath = "/home/me/images/mifoto.png";
        byte[] fileBytes = Files.readAllBytes(Paths.get(filePath));

        // Un IFilePersistor para trabajar con el archivo
        IFilePersistor filePersistor = FilePersistorFactory.getInstance();

        // Creamos un objeto AttachedFile 
        AttachedFile file = new AttachedFile();
        file.setName("mifoto.png");
        file.setData(fileBytes);
		
        // Esto graba el archivo
        filePersistor.save(file);
		
        // Después de grabado, el AttachedFile tiene el id generado
        // por lo que lo asignamos a la propiedad de la vista
        getView().setValue("foto", file.getId());
    }

}
</code></pre>
      <p>Creas un <a href="https://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/web/editors/AttachedFile.html"><i>AttachedFile</i></a>
        y lo guardas con un <a href="https://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/web/editors/IFilePersistor.html"><i>IFilePersistor</i></a>,
        luego obtienes el id del archivo para usarlo como valor para la
        propiedad. La propiedad <i>foto</i> almacena el id del archivo.</p>
      <p>El proceso contrario, es decir, obtener y manipular el archivo que ya
        hay en la propiedad <i>@File</i>, sería así:</p>
      <pre><code class="language-java">import java.nio.file.*;

import org.openxava.actions.*;
import org.openxava.web.editors.*;

public class GrabarFoto extends ViewBaseAction {

    public void execute() throws Exception {
        // Un IFilePersistor para trabajar con el archivo
        IFilePersistor filePersistor = FilePersistorFactory.getInstance();
		
        // Obtenemos el id de la foto de la propiedad
        String photoId = getView().getValueString("foto");
		
        // Y buscamos el AttachedFile a partir del id usando IFilePersistor
        AttachedFile file = filePersistor.find(photoId);
		
        // Obtenemos el nombre y el contenido del AttachedFile
        String fileName = file.getName();
        byte[] fileBytes = file.getData();
		
        // En este ejemplo grabamos el archivo en el sistema de archivos
        // pero tú puedes hacer lo que quieras con él
        String filePath = "/home/me/images/" + fileName;
        Files.write(Paths.get(filePath), fileBytes);
    }

}
</code></pre>
      <p>Buscas un <i>AttachedFile</i> usando un <i>IFilePersistor</i> a
        partir del id de la foto que tienes en la propiedad.</p>
      <p>Trabajar con <i>@Files</i> o <i>@Stereotype("ARCHIVOS")</i> es
        ligeramente diferente, porque en este caso en la propiedad se almacen el
        id de la librería, no del archivo. Una librería es un grupo de archivos.
        Cada archivo tiene su propio id, pero todos comparten un id común de
        librería. Por ejemplo, con una propiedad como esta:</p>
      <pre><code class="language-java">@Files @Column(length=32)
String documentos;
</code></pre>
      <p>Podemos llenarla con varios archivos usando nuestro propio código así:</p>
      <pre><code class="language-java">import java.nio.file.*;

import org.openxava.actions.*;
import org.openxava.web.editors.*;

public class CargarDocumentos
    extends GenerateIdForPropertyBaseAction { // Para usar el método generateIdForProperty()

    public void execute() throws Exception {
        // En este ejemplo vamos a subir algunos archivos desde el sistema de archivos
        // pero podrías obtener los archivos o su contenido desde cualquier otro lugar
        String basePath = "/home/me/documents/";
        String [] fileNames = {
            "limiting-data-by-user.pdf",
            "quick-start.odg"
        };

        // Necesitamos generar un id para la librería la primera vez o usar el que ya existe
        // Este trabajo lo hace generateIdForProperty() por nosotros
        // El id generado se deja en la propiedad 'documentos' en la vista
        String libraryId = generateIdForProperty("documentos"); 
		
        // Un IFilePersistor para trabajar con los archivos
        IFilePersistor filePersistor = FilePersistorFactory.getInstance();
        for (String fileName: fileNames) {
            // En nuestro ejemplo obtenemos el contenido del archivo desde el sistema de archivos
            byte[] fileBytes = Files.readAllBytes(Paths.get(basePath + fileName));
			
            // Creamos un AttachedFile y lo rellenamos
            AttachedFile file = new AttachedFile();
            file.setLibraryId(libraryId); // El mismo libraryId para todos los archivos
            file.setName(fileName);
            file.setData(fileBytes);
			
            // Lo grabamos usando IFilePersistor
            filePersistor.save(file);
        }
    }

}
</code></pre>
      <p>El truco es que tenemos que tener un único id de librería para asignar
        a cada uno de los archivos que vamos a ir guardando. Este id lo
        generamos con <i>generateIdForProperty()</i> que lo genera si no existe
        o lo devuelve si ya existente, también si genera uno nuevo lo asigna a
        la propiedad en la vista, por lo que al grabar la entidad se grabará con
        el id de librería correcto. Lo demás es simplemente un bucle creando <i>
          AttachedFile</i> y grabándolos con <i>IFilePersistor</i>, asignando a
        cada uno el mismo id de librería.</p>
      <p>El proceso contrario, es decir, obtener y manipular los archivos que ya
        hay en la propiedad <i>@Files</i>, sería así:</p>
      <pre><code class="language-java">import java.nio.file.*;
import java.util.*;

import org.openxava.actions.*;
import org.openxava.web.editors.*;

public class GrabarDocumentos extends ViewBaseAction {

    public void execute() throws Exception {
        // Un IFilePersistor para trabajar con los archivos
        IFilePersistor filePersistor = FilePersistorFactory.getInstance();
		
        // Con @Files la propiedad almacena el id de la librería y no un id de archivo
        String libraryId = getView().getValueString("documentos");
		
        // Usamos findLibrary() de IFilePersistor para obtener la colección de archivos
        Collection&lt;AttachedFile&gt; files =filePersistor.findLibrary(libraryId);
        for (AttachedFile file: files) {
            // Obtenemos el nombre y el contenido de AttachedFile
            String fileName = file.getName();
            byte[] fileBytes = file.getData();
            String filePath = "/home/me/documents/" + fileName;
			
            // En nuestro ejemplo lo grabamos en el sistema de archivos, 
            // pero en tu caso puedes hacer lo que quieras
            Files.write(Paths.get(filePath), fileBytes);
        }
    }

}
</code></pre>
      <p>Recuerda que para <i>@Files</i> en la propiedad se guarda el id de la
        librería, no el id del archivo. A partir de este id usamos el método <i>findLibrary()</i>
        de <i>IFilePersistor</i> para obtener todos los archivos asociados a
        esa librería, es decir a esa propiedad. Después hacemos un bucle sobre
        esos archivos y los procesamos al gusto.</p>
      <h3 id="discusion">Discusión <em>(nuevo en v5.6)</em></h3>
      Si quieres que una propiedad de tu componente contenga un hilo de
      discusión, como los que hay en los foros, gestores de incidencias, blogs,
      etc. Sólo has de anotar tu propiedad con <i>@Discussion</i> <i>(nuevo en
        v6.6)</i>, de esta manera:<br>
      <pre><code class="language-java">@Discussion
@Column(length=32)
private String discusion;
</code></pre>O con el estereotipo DISCUSION si usas una versión anterior a la
      6.6. Así:</div>
    <div class="wiki" style="display: block;">
      <pre><code class="language-java">@Stereotype("DISCUSION")
@Column(length=32)
private String discusion;
</code></pre> </div>
    <div class="wiki" style="display: block;">Si además quieres que cuando se
      borre tu entidad su discusión también se elimine completamente de la base
      de datos, has de añadir el siguiente código a tu entidad:<br>
      <pre><code class="language-java">@PreRemove
private void borrarDiscusion() {
    DiscussionComment.removeForDiscussion(discusion);
}</code></pre>
      Verifica que <em>persistence.xml</em> contiene la entidad <em>DiscussionComment</em>,
      si no añádelo:<br>
      <pre><code class="language-xml">&lt;persistence-unit name="default"&gt;
 &lt;provider&gt;org.hibernate.ejb.HibernatePersistence&lt;/provider&gt;
 &lt;non-jta-data-source&gt;java:comp/env/jdbc/OpenXavaTestDS&lt;/non-jta-data-source&gt;
 &lt;class&gt;org.openxava.session.GalleryImage&lt;/class&gt;
 &lt;class&gt;org.openxava.web.editors.DiscussionComment&lt;/class&gt; &lt;!-- AÑADE ESTA LÍNEA --&gt;
  ...
&lt;/persistence-unit&gt;
&nbsp;</code></pre>
      Fíjate que hemos añadido <em>&lt;class&gt;org.openxava.web.editors.DiscussionComment&lt;/class&gt;</em>.
      Cuando se genere la base datos, la tabla OXDISCUSSIONCOMMENTS se creará:<br>
      <pre><code class="language-sql">CREATE TABLE OXDISCUSSIONCOMMENTS (
    ID VARCHAR(32) NOT NULL,
    COMMENT CLOB(16777216),
    DISCUSSIONID VARCHAR(32),
    TIME TIMESTAMP,
    USERNAME VARCHAR(30),
    PRIMARY KEY (ID)
);
&nbsp;
CREATE INDEX OXDISCUSSIONCOMMENTS_DISCUSSIONID_INDEX
    ON OXDISCUSSIONCOMMENTS (DISCUSSIONID);</code></pre>
      Comprueba que el tipo para la columna COMMENT es el más adecuado para
      almacenar un texto grande (CLOB por defecto) en tu base de datos, si no
      haz un ALTER COLUMN para poner un tipo mejor.<br>
      Con Tomcat 6 has de editar la clase <em>org.openxava.web.editors.DiscussionComment</em>
      y quitarle la anotación <em>@Lob</em> de la propiedad <em>comment</em>.</div>
    <div class="wiki" style="display: block;">
      <h3><a name="coordenadas"></a>Coordenadas <em>(nuevo en v6.6)</em></h3>
      Una propiedad coordenadas te permite escoger un punto en un mapa y
      guardarlo. Para definirla anota tu propiedad con <i>@Coordinates</i> o <i>@Stereotype("COORDENADAS")</i>:
      <div class="wiki" style="display: block;">
        <pre><code class="language-java">@Coordinates @Column(length=50)
private String ubicacion;
</code></pre> </div>
      <div class="wiki" style="display: block;">Fíjate en el tipo, <i>String</i>,
        y la longitud, 50, suficiente para almacenar coordenadas. A partir del
        código de arriba obtienes:</div>
      <img src="files/model_es003.png" alt="model_es003.png" title="model_es003.png">
      <div class="wiki" style="display: block;">El usuario puede marcar en
        cualquier parte del mapa y las coordenadas cambiarán. También si teclea
        o pega las coordenadas en el campo el mapa y la marca se reposicionan.</div>
      <div class="wiki" style="display: block;">Puedes usar <i>@Coordinates</i>
        sin ninguna configuración especial, sin embargo tienes la opción de
        cambiar el proveedor de imágenes de trozos de mapa (<i>tile provider</i>)
        en <i>xava.properties</i>. OpenXava usa una librería JavaScript de
        código abierto para dibujar los mapas (<a href="https://leafletjs.com/">Leaflet</a>)
        y los mapas son gratuitos, de <a href="https://www.openstreetmap.org/">OpenStreetMap</a>.
        Aún así necesitamos un servidor para generar las imágenes de lo mapas
        bajo demanda y para eso deberíamos instalar y configurar un software en
        un servidor que convierta los mapas en imágenes y los envíe al
        componente JavaScript. Configurar este servidor es complejo y cuesta
        tiempo, por eso la mayoría de las veces es más conveniente usar
        servidores de terceros que ofrecen ese servicio, lo que llamamos en
        inglés <i>tile providers</i>. OpenXava te permite definir el <i>tile
          provider</i> que quieras en <i>xava.properties</i>. Por defecto,
        viene configurado para usar <a href="https://opentopomap.org/">OpenTopoMap</a>
        con estas entradas en <i>xava.properties</i>:</div>
      <div class="wiki" style="display: block;">
        <pre><code class="language-properties"># OpenTopoMap 
mapsTileProvider=https://b.tile.opentopomap.org/{z}/{x}/{y}.png
mapsAttribution=Map data © &lt;a href="https://www.openstreetmap.org/copyright"&gt;OpenStreetMap&lt;/a&gt; contributors, Imagery © &lt;a href="https://opentopomap.org"&gt;OpenTopoMap&lt;/a&gt; (&lt;a href="https://creativecommons.org/licenses/by-sa/3.0/"&gt;CC-BY-SA&lt;/a&gt;)
</code></pre> </div>
      <div class="wiki" style="display: block;">OpenTopoMap es de libre uso
        incluso para proyectos comerciales con la licencia CC-BY-SA.</div>
      <div class="wiki" style="display: block;">Puedes definir otros
        proveedores, como <a href="https://www.mapbox.com/">MapBox</a>, de esta
        manera: </div>
      <div class="wiki" style="display: block;">
        <pre><code class="language-properties"># MapBox 
# Cambia abajo YOUR_ACCESS_TOKEN por tu propio token de acceso
mapsTileProvider=https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/{z}/{x}/{y}?access_token=YOUR_ACCESS_TOKEN
mapsAttribution=Map data © &lt;a href="https://www.openstreetmap.org/copyright"&gt;OpenStreetMap&lt;/a&gt; contributors, Imagery © &lt;a href="https://www.mapbox.com/"&gt;Mapbox&lt;/a&gt;
mapsTileSize=512
mapsZoomOffset=-1
</code></pre> </div>
      <div class="wiki" style="display: block;">MapBox es un proveedor
        comercial, aunque ofrecen planes gratuitos. Has de registrarte en <a href="https://www.mapbox.com/">https://www.mapbox.com/</a>
        para obtener un token de acceso. Recuerda cambiar YOUR_ACCESS_TOKEN en
        la URL por tu propio token de acceso. Para este proveedor has de definir
        <i>mapsTileSize</i> y <i>mapsZoomOffset</i> para que los mapas se
        visualicen bien. Con MapBox el mapa anterior tendría este aspecto:</div>
      <img src="files/model_es005.png" alt="model_es005.png" title="model_es005.png">
      <div class="wiki" style="display: block;">Aparte de OpenTopoMap y MaxBox
        puedes usar cualquier otro <i>tile provider</i>, como <a href="https://stamen.com/">Stamen</a>,
        <a href="https://www.openstreetmap.org/">OpenStreeMap</a> o <a href="https://www.thunderforest.com/">Thunderforest</a>.</div>
      <div class="wiki" style="display: block;">El editor para <i>@Coordinates</i>
        es un editor con marco, es decir están dentro de un marco que el usuario
        puede plegar. Puedes usar las <a href="view_es.html">características de
          disposición de OpenXava por medido de <i>@View</i></a> para ponerlo
        en la interfaz de usuario en la forma que quieras, por ejemplo, si
        quieres un formulario con todos los campos a la izquierda y el mapa a la
        derecha, puedes escribir una anotación <i>@View</i> como esta:</div>
      <div class="wiki" style="display: block;">
        <pre><code class="language-java">@View(members=
    "ciudad [ estado; "
        + "condicionEstado;"
        + "codigo;"
        + "nombre;"
        + "población;"
        + "codigoPostal;"
        + "condado;"
        + "pais;"
        + "fundacion;"
        + "superficie;"
        + "altitud;"
        + "tipoGobierno;"
        + "alcalde;"
    + "], "
    + "ubicacion")
</code></pre> </div>
      <div class="wiki" style="display: block;">Donde <i>ubicacion</i> es una
        propiedad <i>@Coordinates</i>. Fíjate que usamos un grupo (las
        propiedades entre corchetes []) para las propiedades planas y colocamos
        la propiedad <i>ubicacion</i> al lado (usando una coma). El resultado
        es:</div>
      <img src="files/model_es007.png" alt="model_es007.png" title="model_es007.png"><br>

      <h3><a name="firma-manuscrita"></a>Firma manuscrita <em>(nuevo en v7.6)</em></h3>
      <i>La firma manuscrita sólo está disponible con <a href="https://openxava.org/xavapro">XavaPro</a></i>
      <p>Para permitir al usuario firmar a mano y guardar su firma en una propiedad,
        has de anotar la propiedad con <i>@HandwrittenSignature</i> o <i>@Stereotype("FIRMA_MANUSCRITA")</i>:</p>
      <pre><code class="language-java">import com.openxava.annotations.*; // No org.openxava.annotations.*

...

@HandwrittenSignature
@Column(length=32)  
private String firmaCliente;</code></pre>
      <p>Nota como la anotación está en el paquete <i>com.openxava.annotations</i> (de XavaPro) y no 
        en <i>org.openxava.annotations</i>.</p>
      <p>La propiedad se visualizaría así:</p>
      <img src="files/model_es007bis.png" alt="model_es007bis.png" title="model_es007bis.png">
      <p>El usuario podrá firmar con el dedo o un lapiz para pantallas táctiles, especialmente
        pensado para móviles y tablets, aunque también es posible firmar usando el ratón.</p>
      <p>El tipo de la propiedad es un <i>String</i> de 32 caracteres donde se almacena un id,
        no la firma en sí. Las firmas se pueden almacenar 
        <a href="#Modelo-Propiedades-Estereotipos%20ARCHIVO%20%28nuevo%20en%20v5.0%29//%20y%20ARCHIVOS%20//%28nuevo%20en%20v5.1%29-Almacenamiento%20en%20el%20Sistema%20de%20Archivos">
          en el sistema de archivos</a>
        o 
        <a href="#Modelo-Propiedades-Estereotipos%20ARCHIVO%20%28nuevo%20en%20v5.0%29//%20y%20ARCHIVOS%20//%28nuevo%20en%20v5.1%29-Almacenamiento%20en%20Base%20de%20Datos">
          en la base de datos</a>, usando el mismo mecanismo (el mismo <i>filePersistorClass</i>)
        que <i>@File</i> y <i>@Files</i>. También es posible <a href="#manipular-archivos-por-codigo">
          manipular las firmas por código con <i>FilePersistorFactory</i></a> como 
          con <i>@File</i> y <i>@Files</i>.</p>  


      <h3><a name="mascaras"></a>Máscara <em>(nuevo en v7.1)</em></h3>
      Una máscara es una cadena de carácteres que define el formato válido de
      los valores de entrada. Para esto debes usar la anotación <i>@Mask</i>
      con algunos de los siguientes validadores:<br>
      <ul>
        <li>'L': el usuario deberá ingresar en su lugar una letra alfabética de
          A ~ z.</li>
        <li>'0': el usuario deberá ingresar en su lugar un dígito.</li>
        <li>'A': el usuario deberá ingresar en su lugar un carácter
          alfanumérico.</li>
        <li>'#': el usuario deberá ingresar en su lugar un dígito, espacio en
          blanco, '+' o '-'.</li>
      </ul>
      <br>
      También puedes agregar carácteres especiales, espacio en blanco de manera
      estática e incluso combinar los validadores, por ejemplo:<br>
      <pre><code class="language-java">@Mask("L-000000")
private String pasaporte;

@Mask("0000 0000 0000 0000")
private String tarjeta;

@Mask("LL 000 AA")
private String patente;

@Mask("0.000/0-000")
private String customMask;
</code></pre> <img src="files/model_es008.png" alt="model_es008.png" title="model_es008.png">
      <h3 id="toc11"><a name="Modelo-Propiedades-Concurrencia+y+propiedad+version"></a>Concurrencia
        y propiedad versión</h3>
      Concurrencia es la habilidad de una aplicación para permitir que varios
      usuarios graben datos al mismo tiempo sin perder información. OpenXava usa
      un esquema de concurrencia optimista. Usando concurrencia optimista los
      registros no se bloquean permitiendo un alto nivel de concurrencia sin
      perder la integridad de la información.<br>
      Por ejemplo, si un usuario A lee un registro y entonces un usuario B lee
      el mismo registro, lo modifica y graba los cambios, cuando el usuario A
      intente grabar el registro recibirá un error y tendrá que refrescar los
      datos y reintentar su modificación.<br>
      Para activar el soporte de concurrencia para un componente OpenXava solo
      necesitamos declarar una propiedad usando <em><a class="wiki_link_ext" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/Version.html"

          rel="nofollow">@Version</a></em>, de esta manera:<br>
      <pre><code class="language-java">@Version
private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/Integer.html">Integer</a> version;</code></pre>
      Esta propiedad es para uso del mecanismo de persistencia (Hibernate o
      JPA), ni nuestra aplicación ni usuarios deberían acceder directamente a
      ella. Si no usas evolución automática de esquema recuerda añadir la
      columna VERSION a la tabla.
      <h3 id="toc12"><a name="Modelo-Propiedades-Enums"></a>Enums</h3>
      OpenXava soporta <em>enums</em> de Java 5. Un <em>enum</em> permite
      definir una propiedad que solo puede contener los valores indicados.<br>
      Es fácil de usar, veamos un ejemplo:<br>
      <pre><code class="language-java">private Distancia distancia;
public enum Distancia { LOCAL, NACIONAL, INTERNACIONAL };</code></pre>
      La propiedad <em>distancia</em> solo puede valer LOCAL, NACIONAL o
      INTERNACIONAL, y como no hemos puesto <em>@Required</em> también permite
      valor vacío (null). Desde v5.3 si pones <em>@Required</em>, la primera
      opción es por defecto y ya no mostrará valor vacío. Si deseas cambiar la
      opción por defecto usa <em>@DefaultValueCalculator</em>. Desde v5.6.1 los
      enums anotados con <em>@Required</em> en una <a class="wiki_link" href="#Modelo-Clases%20incrustables%20%28Embeddable%29">clase
        incrustable</a> mostrarán valor vacío si ésta es utilizada en una
      colección de elementos.<br>
      <br>
      A nivel de interfaz gráfico la implementación web actual usa un combo. La
      etiqueta para cada valor se obtienen de los archivos <em>i18n</em>.<br>
      A nivel de base datos por defecto guarda el entero (0 para LOCAL, 1 para
      NACIONAL, 2 para INTERNACIONAL y null para cuando no hay valor), pero esto
      se puede configurar fácilmente para poder usar sin problemas bases de
      datos legadas. Ver más de esto último en el <a class="wiki_link" href="mapping_es.html">capítulo
        sobre mapeo</a>.</div>
    <div class="wiki" style="display: block;">
      <h3 id="toc12"><a name="enums-con-icono"></a>Enums con icono <i>(nuevo en
          v6.3)</i></h3>
      Puedes asociar un icono a cada opción de un <i>enum</i> usando <a href="https://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/model/IIconEnum.html"><i>org.openxava.model.IIconEnum</i></a>:<span

        class="sy0"></span>
      <div class="wiki" id="content_view">
        <pre><code class="language-java">public enum Prioridad implements IIconEnum { 
<br>	BAJA("transfer-down"), MEDIA("square-medium"), ALTA("transfer-up");

	private String icon;

	private Priority(String icon) {
		this.icon = icon;
	}

	public String getIcon() {
		return icon;
	} 
		
};
private Prioridad prioridad;
</code></pre>Simplemente haz que tu <i>enum</i> implemente <i>IIconEnum</i>
        que fuerza a que tengas un método <i>getIcon()</i>. Este método ha de
        devolver un identificador de icono de <a href="https://pictogrammers.com/library/mdi/">Material
          Design Icons</a>. OpenXava puede usar estos iconos en varias partes de
        la interfaz de usuario, por ejemplo en la lista:</div>
      <img src="files/model_es010.png">
      <h3 id="toc13"><a name="Modelo-Propiedades-Propiedades calculadas"></a>Propiedades
        calculadas</h3>
      Las propiedades calculadas son de solo lectura (solo tienen <em>getter</em>)
      y no persistentes (no se almacenan en ninguna columna de la tabla de base
      de datos).<br>
      Una propiedad calculada se define de esta manera:<br>
      <pre><code class="language-java">@Depends("precioUnitario") // 1
@Max(9999999999L) // 2
public <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/math/BigDecimal.html">BigDecimal</a> getPrecioUnitarioEnPesetas() {
 if (precioUnitario == null) return null;
 return precioUnitario.multiply(new <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/math/BigDecimal.html">BigDecimal</a>("166.386"))
 .setScale(0, <a

href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/math/BigDecimal.html">BigDecimal</a>.ROUND_HALF_UP);
}
&nbsp;</code></pre>
      De acuerdo con esta definición ahora podemos usar el código de esta
      manera:<br>
      <pre><code class="language-java">Producto producto = ...
producto.setPrecioUnitario(2);
<a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/math/BigDecimal.html">BigDecimal</a> resultado = producto.getPrecioUnitarioEnPesetas();
&nbsp;</code></pre>
      Y <em>resultado</em> contendrá 332,772.<br>
      Cuando la propiedad <em>precioUnitarioEnPesetas</em> se visualiza al
      usuario no es editable, y su editor tiene una longitud de 10, indicado
      usando <em>@Max(9999999999L)</em> (2). También, dado que usamos <em>@Depends("precioUnitario")</em>
      (1) cuando el usuario cambie la propiedad <em>precioUnitario</em> en la
      interfaz de usuario la propiedad <em>precioUnitarioEnPesetas</em> será
      recalculada y su valor será refrescado de cara al usuario. <i>@Depends</i>
      permite definir varias propiedades separadas por comas y se puede depender
      de propiedades planas y referencias, consulta el <a href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/Depends.html">JavaDoc
        de <i>@Depends</i></a> para más detalles.<br>
      Desde una propiedad calculada tenemos acceso a conexiones JDBC. Un
      ejemplo:<br>
      <pre><code class="language-java">@Max(999)
public int getCantidadLineas() {
 // Un ejemplo de uso de JDBC
 <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/sql/Connection.html">Connection</a> con = null;
 try {
 con = DataSourceConnectionProvider.getByComponent("Factura").getConnection(); // 1
 <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> tabla = MetaModel.get("LineaFactura").getMapping().getTable();
 <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/sql/PreparedStatement.html">PreparedStatement</a> ps = con.prepareStatement("select count(*) from " + tabla +
 " where FACTURA_AÑO = ? and FACTURA_NUMERO = ?");
 ps.setInt(1, getAño());
 ps.setInt(2, getNumero());
 <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/sql/ResultSet.html">ResultSet</a> rs = ps.executeQuery();
 rs.next();
 <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/Integer.html">Integer</a> result = new <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/Integer.html">Integer</a>(rs.getInt(1));
 ps.close();
 return result;
 }
 catch (<a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/Exception.html">Exception</a> ex) {
 log.error("Problemas al calcular cantidad de líneas de una Factura", ex);
 // Podemos lanzar cualquier RuntimeException aquí
 throw new <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/org/omg/CORBA/SystemException.html">SystemException</a>(ex);
 }
 finally {
 try {
 con.close();
 }
 catch (<a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/Exception.html">Exception</a> ex) {
 }
 }
}
&nbsp;</code></pre>
      Es verdad, el código JDBC es feo y complicado, pero a veces puede ayudar a
      resolver problemas de rendimiento. La clase <em>DataSourceConnectionProvider</em>
      nos permite obtener la conexión asociada a la misma fuente de datos que la
      entidad indicada (en este caso <em>Factura</em>). Esta clase es para
      nuestra conveniencia, también podemos acceder a una conexión JDBC usando
      JNDI o cualquier otro medio que queramos. De hecho, en una propiedad
      calculada podemos escribir cualquier código que Java nos permita.<br>
      Si estamos usando acceso basado en propiedades, es decir si anotamos los <em>getters</em>
      o <em>setters,</em> entonces hemos de añadir la anotación <em><a class="wiki_link_ext"

          href="http://java.sun.com/javaee/5/docs/api/javax/persistence/Transient.html"

          rel="nofollow">@Transient</a></em> a nuestra propiedad calculada, de
      esta forma:<br>
      <pre><code class="language-java">private long codigo;

@Id @Column(length=10) // Anotamos el getter,
public long getCodigo() { // por tanto JPA usará acceso basado en propiedades para nuestra clase
 return codigo;
}
public void setCodigo(long codigo) {
 this.codigo = codigo;
}

@Transient // Hemos de anotar como Transient nuestra propiedad calculada
public <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> getZoneOne() { // porque usamos acceso basado en propiedades
 return "En ZONA 1";
}</code></pre>
      <h3 id="toc14"><a name="Modelo-Propiedades-Formula (nuevo en v3.1.4)"></a>Fórmula
        <em>(nuevo en v3.1.4)</em></h3>
      Usando <em><a class="wiki_link_ext" href="http://docs.jboss.org/hibernate/stable/annotations/api/org/hibernate/annotations/Formula.html"

          rel="nofollow">@Formula</a></em> de <a class="wiki_link_ext" href="http://annotations.hibernate.org/"

        rel="nofollow">Hibernate Annotations</a> podemos definir un cálculo para
      nuestra propiedad. Este cálculo se expresa usando SQL, y es ejecutado en
      la propia base de datos, en vez de por Java. Simplemente hemos de escribir
      un fragmento válido de SQL:<br>
      <pre><code class="language-java">@org.hibernate.annotations.Formula("PRECIOUNITARIO * 1.16")
private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/math/BigDecimal.html">BigDecimal</a> precioUnitarioConIVA;
public <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/math/BigDecimal.html">BigDecimal</a> getPrecioUnitarioConIVA() {
 return precioUnitarioConIVA;
}</code></pre>
      El uso es simple. Hemos de poner el cálculo como lo hariamos si lo
      tuvieramos que poner en una sentencia SQL.<br>
      Normalmente las propiedades con <em>@Formula</em> son propiedades de solo
      lectura, es decir, solo tienen <em>getter</em>, no tienen <em>setter</em>.
      Cuando el objeto es leído de la base de datos se hace el cálculo por la
      misma base de datos y se rellena la propiedad con el resultado.<br>
      Esto es una alternativa a las propiedades calculadas. Tiene la ventaja de
      que el usuario puede filtrar por esta propiedad en modo lista, y la
      desventaja de que hemos de usar SQL en vez de Java, y no podemos usar <em><a

          class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/Depends.html"

          rel="nofollow">@Depends</a></em> para recalcular el valor en vivo.<br>
      <h3 id="toc15"><a name="Modelo-Propiedades-Calculador valor por defecto"></a>Calculador
        valor por defecto</h3>
      Con <em><a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/DefaultValueCalculator.html"

          rel="nofollow">@DefaultValueCalculator</a></em> podemos asociar lógica
      a una propiedad, en este caso la propiedad es lectura y escritura. Este
      calculador se usa para calcular el valor inicial. Por ejemplo:<br>
      <pre><code class="language-java">@DefaultValueCalculator(CurrentYearCalculator.class)
private int año;</code></pre>
      En este caso cuando el usuario intenta crear una nueva factura (por
      ejemplo) se encontrará con que el campo de año ya tiene valor, que él
      puede cambiar si quiere. La lógica para generar este valor está en la
      clase <em>CurrentYearCalculator</em> class, así:<br>
      <pre><code class="language-java">package org.openxava.calculators;

import java.util.*;

/**
 * @author Javier Paniza
 */
public class CurrentYearCalculator implements ICalculator {

 public <a href="http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+Object">Object</a> calculate() throws <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/Exception.html">Exception</a> {
 <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Calendar.html">Calendar</a> cal = <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Calendar.html">Calendar</a>.getInstance();
 cal.setTime(new java.util.<a href="http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+Date">Date</a>());
 return new <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/Integer.html">Integer</a>(cal.get(<a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Calendar.html">Calendar</a>.YEAR));
 }

}
&nbsp;</code></pre>
      Es posible personalizar el comportamiento de un calculador poniendo el
      valor de sus propiedades, como sigue:<br>
      <pre><code class="language-java">@DefaultValueCalculator(
 value=org.openxava.calculators.StringCalculator.class,
 properties={ @PropertyValue(name="string", value="BUENA") }
)
private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> relacionConComercial;</code></pre>
      En este caso para calcular el valor por defecto OpenXava instancia <em>StringCalculator</em>
      y entonces inyecta el valor "BUENA" en la propiedad <em>string</em> de <em>StringCalculator</em>,
      y finalmente llama al método <em>calculate()</em> para obtener el valor
      por defecto para <em>relacionConComercial</em>. Como se ve, el uso de la
      anotación <em><a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/PropertyValue.html"

          rel="nofollow">@PropertyValue</a></em> permite crear calculadores
      reutilizable.<br>
      <em>@PropertyValue</em> permite inyectar valores desde otras propiedades
      visualizadas, de esta forma:<br>
      <pre><code class="language-java">@DefaultValueCalculator(
 value=org.openxava.test.calculadores.CalculadorObservacionesTransportista.class,
 properties={
 @PropertyValue(name="tipoPermisoConducir", from="permisoConducir.tipo")
 }
)
private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> observaciones;</code></pre>
      En este caso antes de ejecutar el calculador OpenXava llena la propiedad <em>permisoConducir</em>
      de <em>CalculadorObservacionesTransportista</em> con el valor de la
      propiedad visualizada <em>tipo</em> de la referencia <em>permisoConducir</em>.
      Como se ve el atributo <em>from</em> soporta propiedades calificadas
      (referencia.propiedad). Además, cada ve que <em>permisoConducir.tipo</em>
      cambia <em>observaciones</em> se recalcula (<em>nuevo en v5.1</em>, con
      versiones anteriores se recalculaba solo la primera vez).<br>
      Además podemos usar <em>@PropertyValue</em> sin <em>from</em> ni <em>value</em>:<br>
      <pre><code class="language-java">@DefaultValueCalculator(value=CalculadorPrecioDefectoProducto.class, properties=
 @PropertyValue(name="codigoFamilia")
)</code></pre>
      En este caso OpenXava coge el valor de la propiedad visualizada <em>codigoFamilia</em>
      y lo inyecta en la propiedad <em>codigoFamilia</em> del calculador, es
      decir <em>@PropertyValue(name="codigoFamilia")</em> equivale a <em>@PropertyValue(name="codigoFamilia",
        from="codigoFamilia")</em>.<br>
      Desde un calculador tenemos acceso a conexiones JDBC, he aquí un ejemplo:<br>
      <pre><code class="language-java">@DefaultValueCalculator(value=CalculadorCantidadLineas.class,
 properties= {
 @PropertyValue(name="año"),
 @PropertyValue(name="numero"),
 }
)
private int cantidadLineas;
&nbsp;</code></pre>
      Y la clase del calculador:<br>
      <pre><code class="language-java">package org.openxava.test.calculadores;
&nbsp;
import java.sql.*;
&nbsp;
import org.openxava.calculators.*;
import org.openxava.util.*;
&nbsp;
/**
 * @author Javier Paniza
 */
public class CalculadorCantidadLineas implements IJDBCCalculator { // 1
&nbsp;
 private IConnectionProvider provider;
 private int año;
 private int numero;
&nbsp;
 public void setConnectionProvider(IConnectionProvider provider) { // 2
 this.provider = provider;
 }
&nbsp;
 public <a href="http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+Object">Object</a> calculate() throws <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/Exception.html">Exception</a> {
 <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/sql/Connection.html">Connection</a> con = provider.getConnection();
 try {
 <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/sql/PreparedStatement.html">PreparedStatement</a> ps = con.prepareStatement(
 "select count(*) from XAVATEST.LINEAFACTURA “ +
 “where FACTURA_AÑO = ? and FACTURA_NUMERO = ?");
 ps.setInt(1, getAño());
 ps.setInt(2, getNumero());
 <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/sql/ResultSet.html">ResultSet</a> rs = ps.executeQuery();
 rs.next();
 <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/Integer.html">Integer</a> result = new <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/Integer.html">Integer</a>(rs.getInt(1));
 ps.close();
 return result;
 }
 finally {
 con.close();
 }
 }
&nbsp;
 public int getAño() {
 return año;
 }
&nbsp;
 public int getNumero() {
 return numero;
 }
&nbsp;
 public void setAño(int año) {
 this.año = año;
 }
&nbsp;
 public void setNumero(int numero) {
 this.numero = numero;
 }
&nbsp;
}</code></pre>
      Para usar JDBC nuestro calculador tiene que implementar <em>IJDBCCalculator</em>
      (1) y entonces recibirá un <em>IConnectionProvider</em> (2) que podemos
      usar dentro de <em>calculate()</em>.<br>
      OpenXava dispone de un conjunto de calculadores incluidos de uso genérico,
      que se pueden encontrar en <em>org.openxava.calculators</em>.<br>
      <h3 id="toc16"><a name="Modelo-Propiedades-Valores por defecto al crear"></a>Valores
        por defecto al crear</h3>
      Podemos indicar que el valor sea calculado justo antes de crear (insertar
      en la base de datos) un objeto por primera vez.<br>
      Usualmente para las claves usamos el estándar JPA. Por ejemplo, si
      queremos usar una columna <em>identity</em> (auto incremento) como clave:<br>
      <pre><code class="language-java">@Id @Hidden
@GeneratedValue(strategy=GenerationType.IDENTITY)
private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/Integer.html">Integer</a> id;
&nbsp;</code></pre>
      Podemos usar otras técnicas de generación, por ejemplo, una <em>sequence</em>
      de base de datos puede ser definida usando el estándar JPA de esta manera:<br>
      <pre><code class="language-java">@SequenceGenerator(name="SIZE_SEQ", sequenceName="SIZE_ID_SEQ", allocationSize=1 )
@Hidden @Id @GeneratedValue(strategy=GenerationType.SEQUENCE, generator="SIZE_SEQ")
private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/Integer.html">Integer</a> id;
&nbsp;</code></pre>
      Si queremos generar un identificador único de tipo String y 32 caracteres,
      podemos usar una extensión de Hibernate de JPA:<br>
      <pre><code class="language-java">@Id @GeneratedValue(generator="system-uuid") @Hidden
@GenericGenerator(name="system-uuid", strategy = "uuid")
private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> oid;
&nbsp;</code></pre>
      Ver la sección 9.1.9 de la especificación JPA 1.0 (parte de JSR-220) para
      aprender más sobre <em>@GeneratedValues</em>.<br>
      Si queremos usar nuestra propia lógica para generar el valor al crear, o
      bien queremos generar un nuevo valor para propiedades que no son clave
      entonces no podemos usar el <em>@GeneratedValue</em> de JPA, aunque es
      fácil resolver estos casos con JPA. Solo necesitamos añadir este código a
      nuestra clase:<br>
      <pre><code class="language-java">@PrePersist
private void calcularContador() {
 contador = new <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/Long.html">Long</a>(<a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/System.html">System</a>.currentTimeMillis()).intValue();
}
&nbsp;</code></pre>
      La anotación JPA <em>@PrePersist</em> hace que este método se ejecute
      antes de insertar datos por primera vez en la base de datos, en este
      método podemos calcular el valor para nuestra clave o incluso para
      propiedades no clave con nuestra propia lógica.<br>
      <h3 id="toc17"><a name="Modelo-Propiedades-Validador de propiedad"></a>Validador
        de propiedad</h3>
      Un validador de propiedad (<em><a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/PropertyValidator.html"

          rel="nofollow">@PropertyValidator</a></em>) ejecuta la lógica de
      validación sobre el valor que se vaya a asignar a esa propiedad antes de
      grabar. Una propiedad puede tener varios validadores:<br>
      <div class="wiki" id="content_view">
        <pre><code class="language-java">@PropertyValidator(value=ValidadorExcluirCadena.class, properties=
    @PropertyValue(name="cadena", value="MOTO")
)
@PropertyValidator(value=ValidadorExcluirCadena.class, properties=
    @PropertyValue(name="cadena", value="COCHE"),
    onlyOnCreate=true
)
private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> descripcion;</code></pre>
        Con un OpenXava anterior a 6.1 has de usar <i>@PropertyValidators</i>
        para englobar las anotaciones, así:</div>
      <pre><code class="language-java">@PropertyValidators ({ // Sólo necesario hasta v6.0.2
    @PropertyValidator(value=ValidadorExcluirCadena.class, properties=
        @PropertyValue(name="cadena", value="MOTO")
    ),
    @PropertyValidator(value=ValidadorExcluirCadena.class, properties=
        @PropertyValue(name="cadena", value="COCHE"),
        onlyOnCreate=true
    )
})
private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> descripcion;</code></pre>
      La forma de configurar el validador (con los <em><a class="wiki_link_ext"

          href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/PropertyValue.html"

          rel="nofollow">@PropertyValue</a></em>, aunque el atributo <em>from</em>
      no funciona, hay que usar <em>value</em> siempre) es exactamente igual
      como en los <a class="wiki_link" href="#Modelo-Referencias-Calculador%20valor%20por%20defecto%20en%20referencias">calculadores</a>.
      Con el atributo <em>onlyOnCreate=”true”</em> se puede definir que esa
      validación solo se ejecute cuando se crea el objeto, y no cuando se
      modifica.<br>
      El código del validador es:<br>
      <pre><code class="language-java">package org.openxava.test.validadores;
&nbsp;
import org.openxava.util.*;
import org.openxava.validators.*;
&nbsp;
/**
 * @author Javier Paniza
 */
&nbsp;
public class ValidadorExcluirCadena implements IPropertyValidator { // 1
&nbsp;
 private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> cadena;
&nbsp;
 public void validate(
 Messages errores, // 2
 <a href="http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+Object">Object</a> valor, // 3
 <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> nombreObjecto, // 4
 <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> nombrePropiedad) // 5
 throws <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/Exception.html">Exception</a> {
 if (valor==null) return;
 if (valor.toString().indexOf(getCadena()) &gt;= 0) {
 errores.add("excluir_cadena",
 nombrePropiedad, nombreObjeto, getCadena());
 }
 }
&nbsp;
 public <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> getCadena() {
 return cadena==null?"":cadena;
 }
&nbsp;
 public void setCadena(<a

href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> cadena) {
 this.cadena = cadena;
 }
&nbsp;
}</code></pre>
      Un validador ha de implementar <em>IPropertyValidator</em> (1), esto le
      obliga a tener un método <em>validate()</em> en donde se ejecuta la
      validación de la propiedad. Los argumentos del método <em>validate()</em>
      son:<br>
      <ol>
        <li><strong>Messages errores</strong>: Un objeto de tipo <em>Messages</em>
          que representa un conjunto de mensajes (una especie de colección
          inteligente) y es donde podemos añadir los problemas de validación que
          encontremos.</li>
        <li><strong>Object valor</strong>: El valor a validar.</li>
        <li><strong>String nombreObjeto</strong>: Nombre del objeto al que
          pertenece la propiedad a validar. Útil para usarlo en los mensajes de
          error.</li>
        <li><strong>String nombrePropiedad</strong>: Nombre de la propiedad a
          validar. Útil para usarlo en los mensajes de error.</li>
      </ol>
      Como se ve cuando encontramos un error de validación solo tenemos que
      añadirlo (con <em>errores.add()</em>) enviando un identificador de
      mensaje y los argumentos. Para que este validador produzca un mensaje
      significativo tenemos que tener en nuestro archivo de mensajes i18n la
      siguiente entrada:<br>
      <pre><code class="language-text">excluir_cadena={0} no puede contener {2} en {1}</code></pre>
      Si el identificador que se envía no está en el archivo de mensajes, sale
      tal cual al usuario; pero lo recomendado es siempre usar identificadores
      del archivo de mensajes.<br>
      La validación es satisfactoria si no se añaden mensajes y se supone
      fallida si se añaden. El sistema recolecta todos los mensajes de todos los
      validadores antes de grabar y si encuentra los visualiza al usuario y no
      graba.<br>
      A partir de v4.6.1 también es posible usar en el validador el mensaje de <em>@PropertyValidator</em>.
      Es decir, podemos escribir:<br>
      <pre><code class="language-java">@PropertyValidator(value=ValidadorTituloLibro.class, message="{libro_rpg_no_permitido}")
private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> titulo;</code></pre>
      Si el mensaje está entre llaves se obtiene de los archivos i18n, si no se
      usa tal cual.<br>
      Además, hemos de implementar la interfaz <em><a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/validators/IWithMessage.html"

          rel="nofollow">IWithMessage</a></em> en el validador:<br>
      <pre><code class="language-java">public class ValidadorTituloLibro implements IPropertyValidator, IWithMessage {
&nbsp;
    private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> message;
&nbsp;
    public void setMessage(<a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> message) throws <a

href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/Exception.html">Exception</a> {
        this.message = message; // Este es message de @PropertyValidator
    }
&nbsp;
    public void validate(Messages errors, <a href="http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+Object">Object</a> value, <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> propertyName, <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> modelName) {
       if (((<a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a>)value).contains("RPG")) {
           errors.add(message); // Podemos añadir el mensaje directamente
       }
    }
&nbsp;
}</code></pre>
      El mensaje especificado en la anotación <em>@PropertyValidator</em>, <em>libro_rpg_no_permitido</em>,
      se inyecta en el validador llamando a <em>setMessage()</em>. Este mensaje
      puede ser añadido directamente como un error.<br>
      El paquete <em><a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/validators/package-summary.html"

          rel="nofollow">org.openxava.validators</a></em> contiene algunos
      validadores de uso común.<br>
      <em>@PropertyValidator</em> está definida como una restriccion de <a class="wiki_link"

        href="model_es.html#Modelo-Bean%20Validation">Bean Validation</a> a
      partir de v5.3 y como una restricción de <a class="wiki_link" href="model_es.html#Modelo-Hibernate%20Validator%20%28nuevo%20en%20v3.0.1%29">Hibernate
        Validator</a> hasta v5.2.x<span class="wiki_link"><em>.</em></span><br>
      Si necesitas usar JPA en tu validador, mira <a class="wiki_link" href="#Modelo-Metodos+de+retrollamada+de+JPA">Usar
        JPA en un validador o método de retrollamada</a>.<br>
      <h3 id="toc18"><a name="Modelo-Propiedades-Validador por defecto (nuevo en v2.0.3)"></a>Validador
        por defecto <em>(nuevo en v2.0.3)</em></h3>
      Podemos definir validadores por defecto para las propiedades de cierto
      tipo o estereotipo. Para esto se usa el archivo <em>validadores.xml</em>
      en <i>src/main/resources/xava</i> (simplemente <em>xava</em> antes v7)
      de nuestro proyecto para definir en él los validadores por defecto.<br>
      Por ejemplo, podemos definir en nuestro <em>xava/validadores.xml</em> lo
      siguiente:<br>
      <pre><code class="language-xml">&lt;validadores&gt;
 &lt;validador-defecto&gt;
 &lt;clase-validador
 clase="org.openxava.test.validadores.ValidadorNombrePersona"/&gt;
 &lt;para-estereotipo stereotipo="NOMBRE_PERSONA"/&gt;
 &lt;/validador-defecto&gt;
&lt;/validadores&gt;</code></pre>
      En este caso estamos asociando el validador <em>ValidadorNombrePersona</em>
      al estereotipo NOMBRE_PERSONA. Ahora si definimos una propiedad como la
      siguiente:<br>
      <pre><code class="language-java">@Required @Stereotype("NOMBRE_PERSONA")
private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> nombre;</code></pre>
      Esta propiedad será validada usando <em>ValidadorNombrePersona</em>
      aunque la propiedad misma no defina ningun validador. <em>ValidadorNombrePersona</em>
      se aplica a todas las propiedades con el estereotipo NOMBRE_PERSONA.<br>
      Podemos también asignar validadores por defecto a un tipo.<br>
      En el archivo <em>validadores.xml</em> podemos definir también los
      validadores para determinar si un valor requerido está presente (ejecutado
      cuando usamos <em>@Required</em>). Además podemos asignar nombre (alias)
      a las clases de los validadores.<br>
      Podemos aprender más sobre los validadores examinando <a href="https://github.com/openxava/openxava/blob/master/openxava/src/main/resources/xava/default-validators.xml"><em>openxava/src/main/resources/xava/default-validators.xml</em></a>
      y <a href="https://github.com/openxava/openxava/blob/master/openxavatest/src/main/resources/xava/validators.xml"><em>openxavatest/src/main/resources/xava/validators.xml</em></a>.<br>
      Los validadores por defecto no se aplican cuando grabamos nuestras
      entidades directamente con la api de JPA.<br>
      <h3 id="toc19"><a name="Modelo-Propiedades-Calculo+(nuevo+en+v5.7)"></a>Cálculo
        <em>(nuevo en v5.7)</em></h3>
      Con <em>@Calculation</em> podemos definir una expresión aritmética para
      hacer el cálculo de la propiedad. La expresión puede contener +, -, *, /,
      (), valores numéricos y nombres de propiedades de la misma entidad. Por
      ejemplo:<br>
      <pre><code class="language-java">@Calculation("((horas * trabajador.precioHora) + desplazamiento - descuento) * porcentajeIVA / 100")
private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/math/BigDecimal.html">BigDecimal</a> total;</code></pre>
      Fíjate como <em>trabajador.precioHora</em> se usa para obtener el valor
      de una referencia.<br>
      El cálculo se ejecuta y visualiza cuando el usuario cambia cualquier valor
      de las propiedades usadas en la expresión en la interfaz de usuario, sin
      embargo el valor no se graba hasta que el usuario no pulsa en el botón de
      grabar. Todas las propiedades usadas en <i>@Calculation</i> (los
      operandos) tienen que estar visualizadas en la interfaz de usuario para
      que <i>@Calculation</i> funcione, si no es el caso deberías usar una
      propiedad calculada convencional en su lugar.<br>
      <h2 id="toc20"><br>
      </h2>
      <h2 id="toc20"><a name="Modelo-Referencias"></a>Referencias</h2>
      Una referencia hace que desde una entidad o agregado se pueda acceder otra
      entidad o agregado. Una referencia se traduce a código Java como una
      propiedad (con su <em>getter</em> y su <em>setter</em>) cuyo tipo es el
      del modelo al que se referencia. Por ejemplo un <em>Cliente</em> puede
      tener una referencia a su <em>Comercial</em>, y así podemos escribir
      código Java como éste:<br>
      <pre><code class="language-java">Cliente cliente = ...
cliente.getComercial().getNombre();
&nbsp;</code></pre>
      para acceder al nombre del comercial de ese cliente.<br>
      La sintaxis para definir referencias es:<br>
      <pre><code class="language-java">@Required // 1
@Id // 2
@SearchKey // 3 Nuevo en v3.0.2
@DefaultValueCalculator // 4
@ManyToOne( // 5
 optional=false // 1
)
private tipo nombreReferencia; // 5
public tipo getNombreReferencia() { ... } // 5
public void setNombreReferencia(tipo nuevoValor) { ... } // 5</code></pre>
      <ol>
        <li><strong>@ManyToOne(optional=false)</strong> (<a class="wiki_link_ext"

            href="http://java.sun.com/javaee/5/docs/api/javax/persistence/ManyToOne.html"

            rel="nofollow">JPA</a>), <strong>@Required</strong> (<a class="wiki_link_ext"

            href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/Required.html"

            rel="nofollow">OX</a>) (opcional, el JPA es el preferido): Indica si
          la referencia es requerida. Al grabar OpenXava comprobará si las
          referencias requeridas están presentes, si no lo están no se producirá
          la grabación y se devolverá una lista de errores de validación.</li>
        <li><strong>@Id</strong> (<a class="wiki_link_ext" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/Id.html"

            rel="nofollow">JPA</a>, opcional): Para indicar si la referencia
          forma parte de la clave. La combinación de propiedades y referencias
          clave se debe mapear a un conjunto de campos en la base de datos que
          no tengan valores repetidos, típicamente con la clave primaria.</li>
        <li><strong><a class="wiki_link" href="model_es#toc14">@DefaultValueCalculator</a></strong>
          (<a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/DefaultValueCalculator.html"

            rel="nofollow">OX</a>, one, opcional): Para implementar la lógica
          para calcular el valor inicial de la referencia. Este calculador ha de
          devolver el valor de la clave, que puede ser un dato simple (solo si
          la clave del objeto referenciado es simple) o un objeto clave (un
          objeto especial que envuelve la clave primaria).</li>
        <li><strong>@SearchKey</strong> (<a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/SearchKey.html"

            rel="nofollow">OX</a>, optional): <em>(Nuevo en v3.0.2)</em> Las
          referencias clave de búsqueda se usan por los usuarios para buscar los
          objetos. Son editables en la interfaz de usuario de las referencias
          permitiendo al usuario teclear su valor para buscar. OpenXava usa los
          miembros clave (<em>@Id</em>) para buscar por defecto, y si los
          miembros clave (<em>@Id</em>) están ocultos usa la primera propiedad
          en la vista. Con <em>@SearchKey</em> podemos elegir referencias para
          buscar explícitamente.</li>
        <li><strong>Declaración de la referencia</strong>: Una declaración de
          referencia convencional de Java con sus <em>getters</em> y <em>setters</em>.
          La referencia se marca con <em><a class="wiki_link_ext" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/ManyToOne.html"

              rel="nofollow">@ManyToOne (JPA)</a></em> y el tipo ha de ser otra
          entidad.</li>
      </ol>
      Un pequeño ejemplo de referencias:<br>
      <pre><code class="language-java">@ManyToOne
private Comercial comercial; // 1
public Comercial getComercial() {
 return comercial;
}
public void setComercial(Comercial comercial) {
 this.comercial = comercial;
}
&nbsp;
@ManyToOne(fetch=FetchType.LAZY)
private Comercial comercialAlternativo; // 2
public Comercial getComercialAlternativo() {
 return comercialAlternativo;
}
public void setComercialAlternativo(Comercial comercialAlternativa) {
 this.comercialAlternativo = comercialAlternativo;
}
&nbsp;</code></pre>
      <ol>
        <li>Una referencia llamada <em>comercial</em> a la entidad <em>Comercial</em>.</li>
        <li>Una referencia llamada <em>comercialAlternativo</em> a la entidad <em>Comercial</em>.
          En este caso usamos <em>fetch=FetchType.LAZY</em>, de esta manera los
          datos son leidos de la base de datos bajo demanda. Este es el enfoque
          más eficiente, pero no es el valor por defecto en JPA, por tanto es
          aconsejable <strong>usar siempre <em>fetch=FetchType.LAZY</em></strong>
          al declarar las referencias.</li>
      </ol>
      Si asumimos que esto está en una entidad llamada <em>Cliente</em>,
      podemos escribir:<br>
      <pre><code class="language-java">Cliente cliente = ...
Comercial comercial = cliente.getComercial();
Comercial comercialAlternativo = cliente.getComercialAlternativo();
&nbsp;</code></pre>
      <h3 id="toc21"><a name="Modelo-Referencias-Calculador valor por defecto en referencias"></a>Calculador
        valor por defecto en referencias</h3>
      En una referencia <strong><em><a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/DefaultValueCalculator.html"

            rel="nofollow">@DefaultValueCalculator</a></em></strong> funciona <a

        class="wiki_link" href="#Modelo-Propiedades-Calculador%20valor%20por%20defecto">como
        en una propiedad</a>, solo que hay que devolver el valor de la clave de
      la referencia.<br>
      Por ejemplo, en el caso de una referencia con clave simple podemos poner:<br>
      <pre><code class="language-java">@ManyToOne(optional=false, fetch=FetchType.LAZY) @JoinColumn(name="FAMILY")
@DefaultValueCalculator(value=IntegerCalculator.class, properties=
 @PropertyValue(name="value", value="2")
)
private Familia familia;</code></pre>
      El método <em>calculate()</em> de este calculador es:<br>
      <pre><code class="language-java">public <a href="http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+Object">Object</a> calculate() throws <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/Exception.html">Exception</a> {
 return new <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/Integer.html">Integer</a>(value);
}
&nbsp;</code></pre>
      Como se puede ver se devuelve un entero, es decir, el valor para familia
      por defecto es la familia cuyo código es el 2.<br>
      En el caso de clave compuesta sería así:<br>
      <pre><code class="language-java">@ManyToOne(fetch=FetchType.LAZY)
@JoinColumns({
 @JoinColumn(name="ZONA", referencedColumnName="ZONA"),
 @JoinColumn(name="ALMACEN", referencedColumnName="CODIGO")
})
@DefaultValueCalculator(CalculadorDefectoAlmacen.class)
private Almacen almacen;</code></pre>
      Y el código del calculador:<br>
      <pre><code class="language-java">package org.openxava.test.calculadores;
&nbsp;
import org.openxava.calculators.*;
&nbsp;
/**
 * @author Javier Paniza
 */
public class CalculadorDefectoAlmacen implements ICalculator {
&nbsp;
  public <a href="http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+Object">Object</a> calculate() throws <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/Exception.html">Exception</a> {
    Almacen clave = new Almacen();
    clave.setNumber(4);
    clave.setZoneNumber(4);
    return clave;
  }
&nbsp;
}</code></pre>
      Devuelve un objeto de tipo <em>Almacen</em> pero rellenando sólo las
      propiedades clave.<br>
      <h3 id="toc22"><a name="Modelo-Referencias-Usar referencias como clave"></a>Usar
        referencias como clave</h3>
      Podemos usar referencias como clave, o como parte de la clave. Hemos de
      declarar la referencia como<br>
      <em><a class="wiki_link_ext" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/Id.html"

          rel="nofollow">@Id</a></em>, y usar una clase clave, como sigue:<br>
      <pre><code class="language-java">@<a href="http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+Entity">Entity</a>
@IdClass(DetalleAdicionalKey.class)
public class DetalleAdicional {
&nbsp;
 // JoinColumn se especifica también en DetalleAdicionalKey por un
 // bug de Hibernate, ver http://opensource.atlassian.com/projects/hibernate/browse/ANN-361
 @Id @ManyToOne(fetch=FetchType.LAZY)
 @JoinColumn(name="SERVICIO")
 private Servicio servicio;
&nbsp;
 @Id @Hidden
 private int contador;
&nbsp;
 ...
&nbsp;
}</code></pre>
      Además, necesitamos escribir la clase clave:<br>
      <pre><code class="language-java">public class DetalleAdicionalKey implements java.io.<a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/io/Serializable.html">Serializable</a> {
&nbsp;
 @ManyToOne(fetch=FetchType.LAZY)
 @JoinColumn(name="SERVICIO")
 private Servicio servicio;
&nbsp;
 @Hidden
 private int contador;
&nbsp;
 // equals, hashCode, toString, getters y setters
 ...
&nbsp;
 }</code></pre>
      Necesitamos escribir la clase clave aunque la clave sea solo una
      referencia con una sola columna clave.<br>
      Es mejor usar esta característica sólo cuando estemos trabajando contra
      bases de datos legadas, si tenemos control sobre el esquema es mejor usar
      un id autogenerado.<br>
      <h3 id="toc23"><a name="Modelo-Referencias-Referencias incrustadas"></a>Referencias
        incrustadas</h3>
      Podemos referenciar a una <a class="wiki_link" href="#Modelo-Clases%20incrustables%20%28Embeddable%29">clase
        incrustable</a> usando la anotación <em><a class="wiki_link_ext" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/Embedded.html"

          rel="nofollow">@Embedded</a></em>. Por ejemplo, en la entidad
      principal podemos escribir:<br>
      <pre><code class="language-java">@Embedded
private Direccion direccion;
&nbsp;</code></pre>
      Y hemos de definir la clase <em>Direccion</em> como incrustable:<br>
      <pre><code class="language-java">package org.openxava.test.model;
&nbsp;
import javax.persistence.*;
import org.openxava.annotations.*;
&nbsp;
/**
 *
 * @author Javier Paniza
 */
&nbsp;
@Embeddable
public class Direccion implements IConPoblacion {
&nbsp;
 @Required @Column(length=30)
 private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> calle;
&nbsp;
 @Required @Column(length=5)
 private int codigoPostal;
&nbsp;
 @Required @Column(length=20)
 private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> poblacion;
&nbsp;
 // ManyToOne dentro de un Embeddable no está soportado en JPA 1.0 (ver en 9.1.34),
 // pero la implementación de Hibernate lo soporta.
 @ManyToOne(fetch=FetchType.LAZY, optional=false) @JoinColumn(name="STATE")
 private Provincia provincia;
&nbsp;
 public <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> getPoblacion() {
 return poblacion;
 }
&nbsp;
 public void setPoblacion(<a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> poblacion) {
 this.poblacion = poblacion;
 }
&nbsp;
 public <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> getCalle() {
 return calle;
 }
&nbsp;
 public void setCalle(<a

href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> calle) {
 this.calle = calle;
 }
&nbsp;
 public int getCodigoPostal() {
 return codigoPostal;
 }
&nbsp;
 public void setCodigoPostal(int codigoPostal) {
 this.codigoPostal = codigoPostal;
 }
&nbsp;
 public Provincia getProvincia() {
 return provincia;
 }
&nbsp;
 public void setProvincia(Provincia provincia) {
 this.provincia = provincia;
 }
&nbsp;
}</code></pre>
      Como se ve una clase incrustable puede implementar una interfaz (1) y
      contener referencias (2), entre otras cosas, pero no puede usar métodos de
      retrollamada de JPA.<br>
      Este código se puede usar así, para leer:<br>
      <pre><code class="language-java">Cliente cliente = ...
Direccion direccion = cliente.getDireccion();
direccion.getCalle(); // para obtener el valor</code></pre>
      O así para establecer una nueva dirección<br>
      <pre><code class="language-java">// para establecer una nueva dirección
Direccion direccion = new Direccion();
direccion.setCalle(“Mi calle”);
direccion.setCodigoPostal(46001);
direccion.setMunicipio(“Valencia”);
direccion.setProvincia(provincia);
cliente.setDireccion(direccion);</code></pre>
      En este caso que tenemos una referencia simple, el código generado es un
      simple JavaBean, cuyo ciclo de vida esta asociado a su objeto contenedor,
      es decir, la <em>Direccion</em> se borrará y creará junto al <em>Cliente</em>,
      jamas tendrá vida propia ni podrá ser compartida por otro <em>Cliente</em>.<br>
      <h2 id="toc24"><a name="Modelo-Colecciones"></a>Colecciones</h2>
      <h3 id="toc25"><a name="Modelo-Colecciones-Colecciones de entidades"></a>Colecciones
        de entidades</h3>
      Podemos definir colecciones de referencias a entidades. Una colección es
      una propiedad Java que devuelve <em>java.util.Collection</em>.<br>
      Aquí la sintaxis para definir una colección:<br>
      <pre><code class="language-java">@Size // 1
@<a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/concurrent/locks/Condition.html">Condition</a> // 2
@OrderBy // 3
@XOrderBy // 4
@OrderColumn // 5
@OneToMany/@ManyToMany // 6
private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Collection.html">Collection</a>&lt;TuEntidad&gt; nombreColeccion; // 5
public <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Collection.html">Collection</a>&lt;TuEntidad&gt; getNombreColeccion() { ... } // 5
public void setNombreColeccion(<a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Collection.html">Collection</a>&lt;TuEntidad&gt; nuevoValor) { ... } // 5
&nbsp;</code></pre>
      <ol>
        <li><strong>@Size</strong> (<a class="wiki_link_ext" href="http://docs.jboss.org/hibernate/beanvalidation/spec/1.1/api/javax/validation/constraints/Size.html"

            rel="nofollow">BV</a>, <a class="wiki_link_ext" href="http://www.hibernate.org/hib_docs/validator/api/org/hibernate/validator/Size.html"

            rel="nofollow">HV</a>, opcional): Cantidad mínima (<em>min</em>) y/o
          máxima (<em>max</em>) de elementos esperados. Esto se valida antes de
          grabar.</li>
        <li><strong>@Condition</strong> (<a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/Condition.html"

            rel="nofollow">OX</a>, opcional): Para restringir los elementos que
          aparecen en la colección. No funciona en relaciones <i>@ManyToMany</i>.</li>
        <li><strong>@OrderBy</strong> (<a class="wiki_link_ext" href="http://docs.oracle.com/javaee/7/api/javax/persistence/OrderBy.html"

            rel="nofollow">JPA</a>, opcional): Para que los elementos de la
          colección aparezcan en un determinado orden.</li>
        <li><strong>@XOrderBy</strong> (<a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/XOrderBy.html"

            rel="nofollow">OX</a>, opcional): <em>@OrderBy</em> de JPA no
          permite usar propiedades calificadas (propiedades de referencias). <em>@XOrderBy</em>
          sí lo permite.</li>
        <li><strong><a class="wiki_link" href="model_es.html#Modelo-Colecciones-Listas%20con%20@OrderColumn%20%28nuevo%20en%20v5.3%29">@OrderColumn</a></strong>
          (<a class="wiki_link_ext" href="http://docs.oracle.com/javaee/7/api/javax/persistence/OrderColumn.html"

            rel="nofollow">JPA</a>, opcional): <em>(Nuevo en v5.3)</em> El
          orden de los elementos en la colección se guarda en la base de datos.
          Una columna especial se crea en la tabla para mantener este orden. La
          colección ha de ser una <em>java.util.List</em>. La interfaz de
          usuario permite al usuario reordenar los elementos de la colección.</li>
        <li><strong>Declaracion de la colección</strong>: Una declaración de
          colección convencional de Java con sus <em>getters</em> y <em>setters</em>.
          La colección se marca con <em><a class="wiki_link_ext" href="http://docs.oracle.com/javaee/7/api/javax/persistence/OneToMany.html"

              rel="nofollow">@OneToMany (JPA)</a></em> o <em><a class="wiki_link_ext"

              href="http://docs.oracle.com/javaee/7/api/javax/persistence/ManyToMany.html"

              rel="nofollow">@ManyToMany (JPA)</a></em> y el tipo ha de ser otra
          entidad.</li>
      </ol>
      Vamos a ver algunos ejemplos. Empecemos por uno simple:<br>
      <pre><code class="language-java">@OneToMany (mappedBy="factura")
private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Collection.html">Collection</a>&lt;Albaran&gt; albaranes;
public <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Collection.html">Collection</a>&lt;Albaran&gt; getAlbaranes() {
 return albaranes;
}
public void setAlbaranes(<a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Collection.html">Collection</a>&lt;Albaran&gt; albaranes) {
 this.albaranes = albaranes;
}
&nbsp;</code></pre>
      Si ponemos esto dentro de una <em>Factura</em>, estamos definiendo una
      colección de los <em>albaranes</em> asociados a esa <em>Factura</em>. La
      forma de relacionarlo se hace en la parte del <a class="wiki_link" href="mapping_es.html">mapeo
        objeto-relacional</a>. Usamos <em>mappedBy="factura"</em> para indicar
      que la referencia <em>factura</em> de <em>Albaran</em> se usa para
      mapear esta colección.<br>
      Ahora podemos escribir código como este:<br>
      <pre><code class="language-java">Factura factura = ...
for (Albaran albaran: factura.getAlbaranes()) {
 albaran.hacerAlgo();
}</code></pre>
      Para hacer algo con todos los albaranes asociados a una factura.</div>
    <div class="wiki" style="display: block;"><br>
    </div>
    <div class="wiki" style="display: block;"> Las referencias de las
      colecciones se asumen bidireccionales, esto quiere decir que si en un <em>Comercial</em>
      tengo una colección <em>clientes</em>, en <em>Cliente</em> tengo que
      tener una referencia a <em>Comercial</em>. Pero puede ocurrir que en <em>Cliente</em>
      tenga más de una referencia a <em>Comercial</em> (por ejemplo, <em>comercial</em>
      y <em>comercialAlternativo</em>) y entonce JPA no sabe cual escoger, por
      eso tenemos el atributo <em>mappedBy</em> de <em>@OneToMany</em>. En
      este caso pondríamos:<br>
      <div class="wiki">
        <pre><code class="language-java">@OneToMany(mappedBy="comercial")
private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Collection.html">Collection</a>&lt;Cliente&gt; clientes;</code></pre>
        Para indicar que es la referencia <em>comercial</em> y no <em>comercialAlternativo</em>
        la que vamos a usar para esta colección.</div>
      <div class="wiki"><br>
      </div>
      Vamos a ver otro ejemplo más complejo, dentro de <em>Factura</em>:<br>
      <pre><code class="language-java">@OneToMany (mappedBy="factura", cascade=CascadeType.REMOVE) // 1
@OrderBy("tipoServicio desc") // 2
@org.hibernate.validator.Size(min=1) // 3
private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Collection.html">Collection</a>&lt;LineaFactural&gt; facturas;</code></pre>
      <ol>
        <li>Usar REMOVE como tipo de cascadaas cascade type hace que cuando el
          usuario borra una factura sus líneas también se borran.</li>
        <li>Con <em>@OrderBy</em> obligamos a que las lineas se devuelvan
          ordenadas por <em>tipoServicio</em>.</li>
        <li>La restricción de <em>@Size(min=1)</em> hace que sea obligado que
          haya al menos una línea para que la factura sea válida.</li>
      </ol>
      <br>
      <h3 id="colecciones-con-condicion">Colecciones con condición</h3>
      Tenemos libertad completa para definir como se obtienen los datos de una
      colección, con <em>@Condition</em> podemos sobreescribir la condición por
      defecto:<br>
      <pre><code class="language-java">@<a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/concurrent/locks/Condition.html">Condition</a>(
 "${almacen.codigoZona} = ${this.almacen.codigoZona} AND " +
 "${almacen.codigo} = ${this.almacen.codigo} AND " +
 "NOT (${codigo} = ${this.codigo})"
)
public <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Collection.html">Collection</a>&lt;Transportista&gt; getCompañeros() {
 return null;
}</code></pre>
      Si ponemos esta colección dentro de <em>Transportista</em>, podemos
      obtener todos los transportista del mismo almacén menos él mismo, es
      decir, la lista de sus compañeros. Es de notar como podemos usar <em>this</em>
      en la condición para referenciar al valor de una propiedad del objeto
      actual. <em>@Condition</em> solo aplica a la interfaz de usuario generada
      por OpenXava, si llamamos directamente a <em>getFellowCarriers()</em>
      retornará nulo. La condición es absoluta, es decir si ponemos <i>@Condition("1
        = 1")</i> mostraría todos los transportista en la base de datos.</div>
    <div class="wiki" style="display: block;">
      <h3 id="colecciones-calculadas">Colecciones calculadas</h3>
    </div>
    <div class="wiki" style="display: block;"> Si con <i>@Condition</i> no
      tenemos suficiente, podemos escribir completamente la lógica que devuelve
      la colección. La colección del punto anterior también se podría haber
      definido así:<br>
      <pre><code class="language-java">public <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Collection.html">Collection</a>&lt;Transportista&gt; getCompañeros() {
 <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/javax/management/Query.html">Query</a> query = XPersistence.getManager().createQuery("from Transportista t where " +
 "t.almacen.codigoZona = :zona AND " +
 "t.almacen.codigo = :codigoAlmacen AND " +
 "NOT (t.codigo = :codigo) ");
 query.setParameter("zona", getAlmacen().getCodigoZona());
 query.setParameter("codigoAlmacen", getAlmacen().getCodigo());
 query.setParameter("codigo", getCodigo());
 return query.getResultList();
}</code></pre>
      Como se ve es un método <em>getter</em>. Obviamente ha de devolver una <em>java.util.Collection</em>
      cuyos elementos sean de tipo <em>Transportista</em>. No hay que definir
      el campo, el setter ni usar <i>@OneToMany</i> o <i>@ManyToMany</i>.
      Únicamente el getter.</div>
    <div class="wiki" style="display: block;">
      <h3 id="colecciones-muchos-a-muchos">Colecciones muchos-a-muchos</h3>
    </div>
    <div class="wiki" style="display: block;">La anotación <em><a class="wiki_link_ext"

          href="http://java.sun.com/javaee/5/docs/api/javax/persistence/ManyToMany.html"

          rel="nofollow">@ManyToMany (JPA)</a></em> permite definir una
      colección con una multiciplidad de muchos-a-muchos. Como sigue:<br>
      <pre><code class="language-java">@<a href="http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+Entity">Entity</a>
public class Cliente {
 ...
 @ManyToMany
 private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Collection.html">Collection</a>&lt;Provincia&gt; provincias;
 ...
}
&nbsp;</code></pre>
      En este caso un cliente tiene una colección de provincias, pero una misma
      provincia puede estar presente en varios clientes.<br>
      <h3 id="toc26"><a name="Modelo-Colecciones-Colecciones incrustadas"></a>Colecciones
        incrustadas</h3>
      Las colecciones de objetos incrustados no se soportaban en las primeras
      versiones de JPA, por eso con OpenXava las simulabamos usando colecciones
      a entidades con tipo de cascada REMOVE o ALL. OpenXava trata estas
      colecciones de una manera especial y seguimos llamando a estas colecciones
      <em>colecciones incrustadas</em>.<br>
      Ahora un ejemplo de una colección incrustada. En la entidad principal (por
      ejemplo de <em>Factura</em>) podemos poner:<br>
      <pre><code class="language-java">@OneToMany (mappedBy="factura", cascade=CascadeType.REMOVE)
private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Collection.html">Collection</a>&lt;LineaFactura&gt; lineas;</code></pre>
      Es de notar que usamos <em>CascadeType.REMOVE</em> y <em>LineaFactura</em>
      es una entidad y no una clase incrustable:<br>
      <pre><code class="language-java">package org.openxava.test.model;
&nbsp;
import java.math.*;
&nbsp;
import javax.persistence.*;
&nbsp;
import org.hibernate.annotations.Columns;
import org.hibernate.annotations.Type;
import org.hibernate.annotations.Parameter;
import org.hibernate.annotations.GenericGenerator;
import org.openxava.annotations.*;
import org.openxava.calculators.*;
import org.openxava.test.validators.*;
&nbsp;
/**
 *
 * @author Javier Paniza
 */
&nbsp;
@<a href="http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+Entity">Entity</a>
@EntityValidator(value=ValidadorLineaFactura.class,
 properties= {
 @PropertyValue(name="factura"),
 @PropertyValue(name="oid"),
 @PropertyValue(name="producto"),
 @PropertyValue(name="precioUnitario")
 }
)
public class LineaFactura {
&nbsp;
 @ManyToOne // 'Lazy fetching' produce un falla al borrar una linea desde la factura
 private Factura factura;
&nbsp;
 @Id @GeneratedValue(generator="system-uuid") @Hidden
 @GenericGenerator(name="system-uuid", strategy = "uuid")
 private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> oid;
&nbsp;
 private TipoServicio tipoServicio;
 public enum TipoServicio { ESPECIAL, URGENTE }
&nbsp;
 @Column(length=4) @Required
 private int cantidad;
&nbsp;
 @Stereotype("DINERO") @Required
 private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/math/BigDecimal.html">BigDecimal</a> precioUnitario;
&nbsp;
 @ManyToOne(fetch=FetchType.LAZY, optional=false)
 private Producto producto;
&nbsp;
 @DefaultValueCalculator(CurrentDateCalculator.class)
 private java.util.<a href="http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+Date">Date</a> fechaEntrega;
&nbsp;
 @ManyToOne(fetch=FetchType.LAZY)
 private Comercial vendidoPor;
&nbsp;
 @Stereotype("MEMO")
 private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> observaciones;
&nbsp;
 @Stereotype("DINERO") @Depends("precioUnitario, cantidad")
 public <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/math/BigDecimal.html">BigDecimal</a> getImporte() {
 return getPrecioUnitario().multiply(new <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/math/BigDecimal.html">BigDecimal</a>(getCantidad()));
 }
&nbsp;
 public boolean isGratis() {
 return getImporte().compareTo(new <a

href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/math/BigDecimal.html">BigDecimal</a>("0")) &lt;= 0;
 }
&nbsp;
 @PostRemove
 private void postRemove() {
 factura.setComentario(factura.getComentario() + "DETALLE BORRADO");
 }
&nbsp;
 public <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> getOid() {
 return oid;
 }
 public void setOid(<a

href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> oid) {
 this.oid = oid;
 }
 public TipoServicio getTipoServicio() {
 return tipoServicio;
 }
 public void setTipoServicio(TipoServicio tipoServicio) {
 this.tipoServicio = tipoServicio;
 }
 public int getCantidad() {
 return cantidad;
 }
 public void setCantidad(int cantidad) {
 this.cantidad = cantidad;
 }
 public <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/math/BigDecimal.html">BigDecimal</a> getPrecioUnitario() {
 return precioUnitario==null?<a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/math/BigDecimal.html">BigDecimal</a>.ZERO:precioUnitario;
 }
 public void setPrecioUnitario(<a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/math/BigDecimal.html">BigDecimal</a> precioUnitario) {
 this.precioUnitario = precioUnitario;
 }
&nbsp;
 public Product getProducto() {
 return producto;
 }
&nbsp;
 public void setProducto(Producto producto) {
 this.producto = producto;
 }
&nbsp;
 public java.util.<a href="http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+Date">Date</a> getFechaEntrega() {
 return fechaEntrega;
 }
&nbsp;
 public void setFechaEntrega(java.util.<a href="http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+Date">Date</a> fechaEntrega) {
 this.fechaEntrega = fechaEntrega;
 }
&nbsp;
 public Comercial getVendidoPor() {
 return vendidoPor;
 }
&nbsp;
 public void setVendidoPor(Comercial vendidoPor) {
 this.vendidoPor = vendidoPor;
 }
&nbsp;
 public <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> getObservaciones() {
 return observaciones;
 }
&nbsp;
 public void setObservaciones(<a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> observaciones) {
 this.observaciones = observaciones;
 }
&nbsp;
 public Invoice getFactura() {
 return factura;
 }
&nbsp;
 public void setFactura(Factura factura) {
 this.factura = factura;
 }
&nbsp;
}</code></pre>
      Como se ve esto es una entidad compleja, con calculadores, validadores,
      referencias y así por el estilo. También hemos de definir una referencia a
      su clase contenedora (<em>factura</em>). En este caso cuando una factura
      se borre todas sus líneas se borrarán también. Además hay diferencias a
      nivel de interface gráfica (podemos aprender más en el capítulo de la <a

        class="wiki_link" href="view_es.html">vista</a>).<br>
      <h3 id="toc27"><a name="Modelo-Colecciones-Colecciones de elementos (nuevo en v5.0)"></a>Colecciones
        de elementos <em>(nuevo en v5.0)</em></h3>
      A partir de JPA 2.0 puedes definir una colección de auténticos <a class="wiki_link"

        href="#Modelo-Clases%20incrustables%20%28Embeddable%29">objetos is</a>.
      Llamamos a estas colecciones <em>colecciones de elementos</em>.<br>
      Esta es la sintaxis para las colecciones de elementos:<br>
      <pre><code class="language-java">@Size // 1
@OrderBy // 2
@OrderColumn // 3  Nuevo en v5.3
@ElementCollection // 4
private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Collection.html">Collection</a>&lt;TuClaseIncrustable&gt; nombreColeccion; // 3
public <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Collection.html">Collection</a>&lt;TuClaseIncrustable&gt; getNombreColeccion() { ... } // 3
public void setNombreColeccion&lt;TuClaseIncrustable&gt; nuevoValor) { ... } // 3</code></pre>
      <ol>
        <li><strong>@Size</strong> (<a class="wiki_link_ext" href="http://docs.jboss.org/hibernate/beanvalidation/spec/1.1/api/javax/validation/constraints/Size.html"

            rel="nofollow">BV</a>, <a class="wiki_link_ext" href="http://www.hibernate.org/hib_docs/validator/api/org/hibernate/validator/Size.html"

            rel="nofollow">HV</a>, opcional): <span style="background-color: #ffffff; line-height: 1.5;">Cantidad
            mínima (</span><em><span style="background-color: #ffffff; line-height: 1.5;">min</span></em><span

            style="background-color: #ffffff; line-height: 1.5;">) y/o máxima (</span><em><span

              style="background-color: #ffffff; line-height: 1.5;">max</span></em><span

            style="background-color: #ffffff; line-height: 1.5;">) de elementos
            esperados. Esto se valida antes de grabar.</span></li>
        <li><strong>@OrderBy</strong> (<a class="wiki_link_ext" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/OrderBy.html"

            rel="nofollow">JPA</a>, opcional): <span style="background-color: #ffffff; line-height: 1.5;">Para
            que los elementos de la colección aparezcan en un determinado orden.</span></li>
        <li><strong><a class="wiki_link" href="model_es.html#Modelo-Colecciones-Listas%20con%20@OrderColumn%20%28nuevo%20en%20v5.3%29">@OrderColumn</a></strong>
          (<a class="wiki_link_ext" href="http://docs.oracle.com/javaee/7/api/javax/persistence/OrderColumn.html"

            rel="nofollow">JPA</a>, opcional): <em>(Nuevo en v5.3)</em> El
          orden de los elementos en la colección se guarda en la base de datos.
          Una columna especial se crea en la tabla para mantener este orden. La
          colección ha de ser una <em>java.util.List</em>. La interfaz de
          usuario permite al usuario reordenar los elementos de la colección.</li>
        <li><strong>Collection declaration</strong>: Una declaración de
          colección Java convencional con sus <em>getters</em> y <em>setters</em>.
          La colección se marca con <em><a class="wiki_link_ext" href="http://docs.oracle.com/javaee/6/api/javax/persistence/ElementCollection.html"

              rel="nofollow">@ElementCollection (JPA)</a></em>. Los elementos
          tienes que ser <a class="wiki_link" href="#Modelo-Clases%20incrustables%20%28Embeddable%29">clases
            incrustables</a>.</li>
      </ol>
      Los elementos en la colección se graban todos a la vez al mismo tiempo que
      la entidad principal. Además, la interfaz de usuario generada permite
      modificar todos los elementos de la colección al mismo tiempo.<br>
      Una clase incrustable usada en una colección de elementos no puede
      contener colecciones de ningún tipo.<br>
      <br>
      Veamos un ejemplo. Primero hemos de definir la colección en la entidad
      principal:<br>
      <pre><code class="language-java">@<a href="http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+Entity">Entity</a>
public class Presupuesto extends Identifiable {
    ...
    @ElementCollection
    private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Collection.html">Collection</a>&lt;LineaPresupuesto&gt; lineas;
&nbsp;
    public <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Collection.html">Collection</a>&lt;LineaPresupuesto&gt; getLineas() {
        return lineas;
    }
    public void setLineas(<a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Collection.html">Collection</a>&lt;LineaPresupuesto&gt; lineas) {
        this.lineas = lineas;
    }
    ...
}</code></pre>
      Ahora definimos nuestra clase incrustada:<br>
      <pre><code class="language-java">@Embeddable
public class LineaPresupuesto {
&nbsp;
    @ManyToOne(fetch=FetchType.LAZY, optional=false) // 1
    private Producto producto;
&nbsp;
    @Required // 2
    private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/math/BigDecimal.html">BigDecimal</a> precioUnitario;
&nbsp;
    @Required
    private int cantidad;
&nbsp;
    private <a href="http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+Date">Date</a> fechaDisponibilidad;
&nbsp;
    @Column(length=30)
    private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> comentarios;
&nbsp;
    @Column(precision=10, scale=2)
    @Depends("precioUnitario, cantidad")
    public <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/math/BigDecimal.html">BigDecimal</a> getImporte() { // 3
        return getPrecioUnitario().multiply(new <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/math/BigDecimal.html">BigDecimal</a>(getCantidad()));
    }
    ...
}</code></pre>
      Como se puede ver, una clase incrustable usada en una colección de
      elementos puede contener referencias(1), validaciones(2) y propiedades
      calculadas(3) entre otras cosas.<br>
      <h3 id="toc28"><a name="Modelo-Colecciones-Listas con @OrderColumn (nuevo en v5.3)"></a>Listas
        con @OrderColumn <em>(nuevo en v5.3)</em></h3>
      Para tener una colección que mantenga el orden de sus elementos se ha de
      usar <em>java.util.List</em> en lugar de <em>java.util.Collection</em> y
      hay que anotar la colección con <em><a class="wiki_link_ext" href="http://docs.oracle.com/javaee/7/api/javax/persistence/OrderColumn.html"

          rel="nofollow">@OrderColumn</a></em>. Es decir, si definimos una
      colección de esta forma:<br>
      <pre><code class="language-java">@OneToMany(mappedBy="proyecto", cascade=CascadeType.ALL)
@OrderColumn
private <a href="http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+List">List</a>&lt;TareaProyecto&gt; tareas;</code></pre>
      La interfaz de usuario permitirá al usuario cambiar el orden de los
      elementos y este orden se almacenará en la base de datos. Además, si se
      cambia el orden de los elementos por código este orden también se
      persistirá en la base de datos.<br>
      Para almacenar el orden, JPA usa una columna especial en la tabla de la
      base de datos, esta columna es para uso interno exclusivamente y no hay
      una propiedad para poder acceder a ella desde el código. Podemos usar <em>@OrderColumn(name="MYCOLUMN")</em>
      para especificar el nombre de la columna si lo necesitamos, si <em>name</em>
      no se especifica se asume el nombre de la colección más "_ORDER". Si se
      usa <em>updateSchema</em>, será la herramienta la que cree la columna
      automáticamente. Si no, es decir, si controlamos el esquema de la base de
      datos nosotros mismos, deberiamos añadir la columna a la tabla, para la
      colección de arriba sería así:<br>
      <pre><code class="language-sql">ALTER TABLE TAREAPROYECTO
ADD TAREAS_ORDER INTEGER</code></pre>
      En la implementación actual el usuario cambia el orden arrastrando y
      soltando, con colecciones <em>@OneToMany</em> el orden se almacena justo
      después de soltar, mientras que en las colecciones <em>@ElementCollection</em>
      el orden se almacen al grabar la entidad contenedora.<br>
      <h2 id="toc29"><a name="Modelo-Métodos"></a>Métodos</h2>
      Los métodos se definen en una entidad OpenXava (mejor dicho, en una
      entidad JPA) como una clase de Java convencional. Por ejemplo:<br>
      <pre><code class="language-java">public void incrementarPrecio() {
 setPrecioUnitario(getPrecioUnitario().multiply(new <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/math/BigDecimal.html">BigDecimal</a>("1.02")).setScale(2));
}</code></pre>
      Los métodos son la salsa de los objetos, sin ellos solo serían caparazones
      tontos alrededor de los datos. Cuando sea posible es mejor poner la lógica
      de negocio en los métodos (capa del modelo) que en las acciones (capa del
      controlador).<br>
      <h2 id="toc30"><a name="Modelo-Buscadores"></a>Buscadores</h2>
      Un buscador es método estático especial que nos permite buscar un objeto o
      una colección de objetos que sigue algún criterio.<br>
      Algunos ejemplos:<br>
      <pre><code class="language-java">public static Cliente findByCodigo(int codigo) throws NoResultException {
 <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/javax/management/Query.html">Query</a> query = XPersistence.getManager().createQuery(
 "from Cliente as o where o.codigo = :codigo");
 query.setParameter("codigo", codigo);
 return (Cliente) query.getSingleResult();
}
&nbsp;
public static <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Collection.html">Collection</a> findTodos() {
 <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/javax/management/Query.html">Query</a> query = XPersistence.getManager().createQuery("from Cliente as o");
 return query.getResultList();
}
&nbsp;
public static <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Collection.html">Collection</a> findByNombreLike(<a

href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> nombre) {
 <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/javax/management/Query.html">Query</a> query = XPersistence.getManager().createQuery(
 "from Cliente as o where o.nombre like :nombre order by o.nombre desc");
 query.setParameter("nombre", nombre);
 return query.getResultList();
}</code></pre>
      Estos métodos se pueden usar de esta manera:<br>
      <pre><code class="language-java">Cliente cliente = Cliente.findByCodigo(8);
<a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Collection.html">Collection</a> javieres = Cliente.findByNombreLike(“%JAVI%”);</code></pre>
      Como se ve, usar método buscadores produce un código más legible que
      usando la verbosa API de JPA. Pero esto es solo una recomendación de
      estilo, podemos escoger no escribir métodos buscadores y usar directamente
      consultas de JPA.<br>
      <h2 id="toc31"><a name="Modelo-Validador de entidad"></a>Validador de
        entidad</h2>
      Este validador (<em><a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/EntityValidator.html"

          rel="nofollow">@EntityValidator</a></em>) permite poner una validación
      a nivel de modelo. Cuando necesitamos hacer una validación sobre varias
      propiedades del modelo, y esta validación no corresponde lógicamente a
      ninguna de ellas se puede usar este tipo de validación.<br>
      Su sintaxis es:<br>
      <pre><code class="language-java">@EntityValidator(
 value=clase, // 1
 onlyOnCreate=(true|false), // 2
 properties={ @PropertyValue ... } // 3
)</code></pre>
      <ol>
        <li><strong>value</strong> (opcional, obligada si no se especifica
          nombre): Clase que implementa la validación. Ha de ser del tipo <em>IValidator</em>.</li>
        <li><strong>onlyOnCreate</strong> (opcional): Si true el validador es
          ejecutado solo cuando estamos creando un objeto nuevo, no cuando
          modificamos uno existente. El valor por defecto es false.</li>
        <li><strong>properties</strong> (varios <em><a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/PropertyValue.html"

              rel="nofollow">@PropertyValue</a></em>, opcional): Para establecer
          valor a las propiedades del validador antes de ejecutarse.</li>
      </ol>
      Un ejemplo:<br>
      <pre><code class="language-java">@EntityValidator(value=org.openxava.test.validadores.ValidadorProductoBarato.class, properties= {
 @PropertyValue(name="limite", value="100"),
 @PropertyValue(name="descripcion"),
 @PropertyValue(name="precioUnitario")
})
public class Producto {</code></pre>
      Y el código del validador:<br>
      <pre><code class="language-java">package org.openxava.test.validadores;
&nbsp;
import java.math.*;
&nbsp;
/**
 * @author Javier Paniza
 */
&nbsp;
public class ValidadorProductoBarato implements IValidator { // 1
&nbsp;
 private int limite;
 private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/math/BigDecimal.html">BigDecimal</a> precioUnitario;
 private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> descripcion;
&nbsp;
 public void validate(Messages errores) { // 2
 if (getDescripcion().indexOf("CHEAP") &gt;= 0 ||
 getDescripcion().indexOf("BARATO") &gt;= 0 ||
 getDescripcion().indexOf("BARATA") &gt;= 0) {
 if (getLimiteBd().compareTo(getPrecioUnitario()) &lt; 0) {
 errors.add("producto_barato", getLimiteBd()); // 3
 }
 }
 }
&nbsp;
 public <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/math/BigDecimal.html">BigDecimal</a> getPrecioUnitario() {
 return precioUnitario;
 }
&nbsp;
 public void setPrecioUnitario(<a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/math/BigDecimal.html">BigDecimal</a> decimal) {
 precioUnitario = decimal;
 }
&nbsp;
 public <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> getDescripcion() {
 return descripcion==null?"":descripcion;
 }
&nbsp;
 public void setDescripcion(<a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> string) {
 descripcion = string;
 }
&nbsp;
 public int getLimite() {
 return limite;
 }
&nbsp;
 public void setLimite(int i) {
 limite = i;
 }
&nbsp;
 private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/math/BigDecimal.html">BigDecimal</a> getLimiteBd() {
 return new <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/math/BigDecimal.html">BigDecimal</a>(<a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/Integer.html">Integer</a>.toString(limite));
 }
&nbsp;
}
&nbsp;</code></pre>
      Este validador ha de implementar <em>IValidator</em> (1), lo que le
      obliga a tener un método <em>validate(Messages messages)</em> (2). En
      este método solo hay que añadir identificadores de mensajes de error (3)
      (cuyos textos estarán en los archivos i18n), si en el proceso de
      validación (es decir en la ejecución de todos los validadores) hubiese al
      menos un mensaje de error, OpenXava no graba la información y visualiza
      los mensajes al usuario.<br>
      En este caso vemos como se accede a <em>descripcion</em> y <em>precioUnitario</em>,
      por eso la validación se pone a nivel de módelo y no a nivel de propiedad
      individual, porque abarca más de una propiedad. <br>
      A partir de v4.6.1 el validador puede implementar <em><a class="wiki_link_ext"

          href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/validators/IWithMessage.html"

          rel="nofollow">IWithMessage</a></em> para inyectar el mensaje desde <em>@EntityValidator</em>,
      funciona como en <a class="wiki_link" href="#Modelo-Propiedades-Validador%20de%20propiedad">el
        caso del validador de propiedad</a>.<br>
      Podemos definir más de un validador por entidad como sigue:<br>
      <div class="wiki" id="content_view">
        <pre><code class="language-java">@EntityValidator(value=org.openxava.test.validadores.ValidadorProductoBarato.class, properties= {
    @PropertyValue(name="limite", value="100"),
    @PropertyValue(name="descripcion"),
    @PropertyValue(name="precioUnitario")
})
@EntityValidator(value=org.openxava.test.validadores.ValidadorProductoCaro.class, properties= {
    @PropertyValue(name="limite", value="1000"),
    @PropertyValue(name="descripcion"),
    @PropertyValue(name="precioUnitario")
})
@EntityValidator(value=org.openxava.test.validadores.ValidadorPrecioProhibido.class,
    properties= {
        @PropertyValue(name="precioProhibido", value="555"),
        @PropertyValue(name="precioUnitario")
    },
    onlyOnCreate=true
)
public class Product {</code></pre>
        Con un OpenXava anterior a 6.1 has de usar <em>@EntityValidators</em>
        para poder aplicar varios validadores:</div>
      <pre><code class="language-java">@EntityValidators({ // Sólo necesario hasta v6.0.2
    @EntityValidator(value=org.openxava.test.validadores.ValidadorProductoBarato.class, properties= {
        @PropertyValue(name="limite", value="100"),
        @PropertyValue(name="descripcion"),
        @PropertyValue(name="precioUnitario")
    }),
    @EntityValidator(value=org.openxava.test.validadores.ValidadorProductoCaro.class, properties= {
        @PropertyValue(name="limite", value="1000"),
        @PropertyValue(name="descripcion"),
        @PropertyValue(name="precioUnitario")
    }),
    @EntityValidator(value=org.openxava.test.validadores.ValidadorPrecioProhibido.class,
        properties= {
            @PropertyValue(name="precioProhibido", value="555"),
            @PropertyValue(name="precioUnitario")
        },
        onlyOnCreate=true
    )
})
public class Product {</code></pre>
      <em>@EntityValidator</em> está definida como una restriccion de <a class="wiki_link"

        href="#Modelo-Bean%20Validation">Bean Validation</a> a partir de v5.3 y
      como una restricción de <a class="wiki_link" href="#Modelo-Hibernate%20Validator%20%28nuevo%20en%20v3.0.1%29">Hibernate
        Validator</a> hasta v5.2.x<span class="wiki_link"><em>.</em></span><br>
      Si necesitas usar JPA en tu validador, mira <a class="wiki_link" href="#Modelo-Metodos+de+retrollamada+de+JPA">Usar
        JPA en un validador o método de retrollamada</a>.<br>
      <h2 id="toc32"><a name="Modelo-Validador al borrar"></a>Validador al
        borrar</h2>
      El <em><a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/RemoveValidator.html"

          rel="nofollow">@RemoveValidator</a></em> también es un validador a
      nivel de modelo, la diferencia es que se ejecuta antes de borrar el
      objeto, y tiene la posibilidad de vetar el borrado.<br>
      Su sintaxis es:<br>
      <pre><code class="language-java">@RemoveValidator(
 value=clase, // 1
 properties={ @PropertyValue ... } // 2
)
&nbsp;</code></pre>
      <ol>
        <li><strong>clase</strong> (obligada): Clase que implementa la
          validación. Ha de ser del tipo <em>IRemoveValidator</em>.</li>
        <li><strong>properties</strong> (varios <em><a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/PropertyValue.html"

              rel="nofollow">@PropertyValue</a></em>, opcional): Para establecer
          valor a las propiedades del calculador antes de ejecutarse.</li>
      </ol>
      Un ejemplo puede ser:<br>
      <pre><code class="language-java">@RemoveValidator(value=ValidadorBorrarTipoAlbaran.class,
 properties=@PropertyValue(name="codigo")
)
public class TipoAlbaran {</code></pre>
      Y el validador:<br>
      <pre><code class="language-java">package org.openxava.test.validadores;
&nbsp;
import org.openxava.test.model.*;
import org.openxava.util.*;
import org.openxava.validators.*;
&nbsp;
/**
 * @author Javier Paniza
 */
public class ValidadorBorrarTipoAlbaran implements IRemoveValidator { // 1
&nbsp;
 private TipoAlbaran tipoAlbaran;
 private int codigo; // Usamos esto (en vez de obtenerlo de tipoAlbaran)
 // para probar @PropertyValue con propiedades simples
&nbsp;
 public void setEntity(<a

href="http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+Object">Object</a> entidad) throws <a

href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/Exception.html">Exception</a> { // 2
 this.tipoAlbaran = (TipoAlbaran) entidad;
 }
&nbsp;
 public void validate(Messages errores) throws <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/Exception.html">Exception</a> {
 if (!tipoAlbaran.getAlbaranes().isEmpty()) {
 errores.add("no_borrar_tipo_albaran_si_albaranes", new <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/Integer.html">Integer</a>(getCodigo())); // 3
 }
 }
&nbsp;
 public int getCodigo() {
 return codigo;
 }
&nbsp;
 public void setCodigo(int codigo) {
 this.codigo = codigo;
 }
&nbsp;
}</code></pre>
      Como se ve tiene que implementar <em>IRemoveValidator</em> (1) lo que le
      obliga a tener un método <em>setEntity()</em> (2) con el recibirá el
      objeto que va a ser borrado. Si hay algún error de validación se añade al
      objeto de tipo <em>Messages</em> enviado a <em>validate()</em> (3). Si
      después de ejecutar todas las validaciones OpenXava detecta al menos 1
      error de validación no realizará el borrado del objeto y enviará la lista
      de mensajes al usuario.<br>
      En este caso si se comprueba si hay albaranes que usen este tipo de
      albarán antes de poder borrarlo.<br>
      Tal y como ocurre con <em>@EntityValidator</em> podemos usar varios <em>@RemoveValidator</em>
      por entidad (con la anotación <em>@RemoveValidators</em> para versiones
      anteriores a 6.1).<br>
      <em>@RemoveValidator</em> se ejecuta cuando borramos entidades desde
      OpenXava (usando <em><a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/model/MapFacade.html"

          rel="nofollow">MapFacade</a></em> o las acciones estándar de OX), pero
      no cuando usamos directamente JPA. Si queremos crear una restricción al
      borrar que sea reconocida por JPA, podemos usar un método de retrollamada
      de JPA, como <em><a class="wiki_link_ext" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/PreRemove.html"

          rel="nofollow">@PreRemove</a></em>.<br>
      <h2 id="toc33"><a name="Modelo-Metodos+de+retrollamada+de+JPA"></a>Métodos
        de retrollamada de JPA</h2>
      Con <em><a class="wiki_link_ext" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/PrePersist.html"

          rel="nofollow">@PrePersist</a></em> podemos indicar que se ejecute
      cierta lógica justo antes de crear el objeto como persistente.<br>
      Como sigue:<br>
      <pre><code class="language-java">@PrePersist
private void antesDeCrear() {
 setDescripcion(getDescripcion() + " CREADO");
}</code></pre>
      En este caso cada vez que se graba por primera vez un <em>TipoAlbaran</em>
      se añade un sufijo a su descripción.<br>
      Como se ve es exactamente igual que cualquier otro método solo que este se
      ejecuta automáticamente antes de crear.<br>
      Con <em><a class="wiki_link_ext" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/PreUpdate.html"

          rel="nofollow">@PreUpdate</a></em> podemos indicar que se ejecute
      cierta lógica justo después de modificar un objeto y justo antes de
      actualizar su contenido en la base de dato, esto es justo antes de hacer
      el UPDATE.<br>
      Como sigue:<br>
      <pre><code class="language-java">@PreUpdate
private void antesDeModificar() {
 setDescripcion(getDescripcion() + " MODIFICADO");
}</code></pre>
      En este caso cada vez que se modifica un <em>TipoAlbaran</em> se añade un
      sufijo a su descripción.<br>
      Como se ve es exactamente igual que cualquier otro método solo que este se
      ejecuta automáticamente antes de modificar.<br>
      Podemos usar todas las anotaciones JPA de retrollamada: <em><a class="wiki_link_ext"

          href="http://java.sun.com/javaee/5/docs/api/javax/persistence/PrePersist.html"

          rel="nofollow">@PrePersist</a></em>, <em><a class="wiki_link_ext" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/PostPersist.html"

          rel="nofollow">@PostPersist</a></em>, <em><a class="wiki_link_ext" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/PreRemove.html"

          rel="nofollow">@PreRemove</a></em>, <em><a class="wiki_link_ext" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/PostRemove.html"

          rel="nofollow">@PostRemove</a></em>, <em><a class="wiki_link_ext" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/PreUpdate.html"

          rel="nofollow">@PreUpdate</a></em>, <em><a class="wiki_link_ext" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/PostUpdate.html"

          rel="nofollow">@PostUpdate</a></em> y <em><a class="wiki_link_ext" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/PostLoad.html"

          rel="nofollow">@PostLoad</a></em>.<br>
      <h2 id="toc34"><a name="Modelo-Metodos+de+retrollamada+de+OX+(nuevo+en+v4.0.1)"></a>Métodos
        de retrollamada de OX <em>(nuevo en V4.0.1)</em></h2>
      Con <em>@PreCreate</em> puede marcar métodos que serán ejecutados antes
      de persistir algún objeto. De esta manera podrá utilizar el manejador de
      persistencia o crear busquedas que no son permitidas dentro de las
      retrollamadas de JPA.<br>
      Por ejemplo, si queremos crear un cliente automaticamente si en la factura
      no se ha seleccionado ninguno.<br>
      <pre><code class="language-java">public onPreCreate {
 // Crea automaticamente un cliente
 if (getCliente() == null) {
 Cliente clte = new Cliente();
 clte.setNombre(getNombre());
 clte.setDireccion(getDireccion());
 clte = XPersistence.getManager().merge(clte);
 setCliente(clte);
 }
}
&nbsp;</code></pre>
      En este ejemplo, la operación del manejador de persistencia, no afectará
      el comportamiento de este y las demás retrollamadas. Además de <em>@PreCreate</em>
      están disponible <em>@PostCreate</em> y <em>@PreDelete</em>. Los métodos
      que son decorados con estas anotaciones forman parte de la misma
      transacción donde se ejecutaran las retrollamadas de JPA. Cuando estas
      retrollamadas son combinadas con las de JPA el orden de ejecución es de
      acuerdo a lo siguiente:<br>
      Para crear una entidad: <em>@PreCreate, @PrePersist(JPA),
        @PostPersist(JPA)</em> y <em>@PostCreate</em>.<br>
      Para borrar una entidad: <em>@PreDelete, @PreRemove(JPA)</em> y <em>@PostRemove(JPA)</em>.<br>
      Los métodos anotados con estas anotaciones deben no retornar ningún valor
      ni tener ningún parámetro. A diferencia de las retrollamadas de JPA, las
      de OX sólo funcionan en las entidades mismas y no son tomadas en cuentas
      en los clases indicadas en <em>@Listeners</em>.<br>
      <h2 id="toc35"><a name="Modelo-Herencia"></a>Herencia</h2>
      OpenXava soporta la herencia de <a class="wiki_link_ext" href="http://en.wikibooks.org/wiki/Java_Persistence/Inheritance"

        rel="nofollow">herencia de JPA</a> y Java.<br>
      Por ejemplo podemos definer una superclase mapeada (<em><a class="wiki_link_ext"

          href="http://java.sun.com/javaee/5/docs/api/javax/persistence/MappedSuperclass.html"

          rel="nofollow">@MappedSuperclass</a></em>) de esta manera:<br>
      <pre><code class="language-java">package org.openxava.test.model;
&nbsp;
import javax.persistence.*;
&nbsp;
import org.hibernate.annotations.*;
import org.openxava.annotations.*;
&nbsp;
/**
 * Clase base para definir entidades con un oid UUID. &lt;p&gt;
 *
 * @author Javier Paniza
 */
&nbsp;
@MappedSuperclass
public class Identificable {
&nbsp;
 @Id @GeneratedValue(generator="system-uuid") @Hidden
 @GenericGenerator(name="system-uuid", strategy = "uuid")
 private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> oid;
&nbsp;
 public <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> getOid() {
 return oid;
 }
&nbsp;
 public void setOid(<a

href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> oid) {
 this.oid = oid;
 }
&nbsp;
}
&nbsp;</code></pre>
      Podemos definir otra <em>@MappedSuperclass</em> que extienda de esta, por
      ejemplo:<br>
      <pre><code class="language-java">package org.openxava.test.model;
&nbsp;
import javax.persistence.*;
&nbsp;
import org.openxava.annotations.*;
&nbsp;
/**
 * Clase base para entidades con una propiedad 'nombre'. &lt;p&gt;
 *
 * @author Javier Paniza
 */
@MappedSuperclass
public class ConNombre extends Identifiable {
&nbsp;
 @Column(length=50) @Required
 private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> nombre;
&nbsp;
 public <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> getNombre() {
 return nombre;
 }
&nbsp;
 public void setNombre(<a

href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> nombre) {
 this.nombre = nombre;
 }
&nbsp;
}
&nbsp;</code></pre>
      Ahora podemos usar <em>Identificable</em> y <em>ConNombre</em> para
      definir nuestra entidades, como sigue:<br>
      <pre><code class="language-java">package org.openxava.test.model;
&nbsp;
import javax.persistence.*;
&nbsp;
/**
 *
 * @author Javier Paniza
 */
&nbsp;
@<a href="http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+Entity">Entity</a>
@DiscriminatorColumn(name="TYPE")
@DiscriminatorValue("HUM")
@Table(name="PERSONA")
@AttributeOverrides(
 @AttributeOverride(name="name", column=@Column(name="PNOMBRE"))
)
public class Humano extends ConNombre {
&nbsp;
 @Enumerated(EnumType.STRING)
 private Sexo sexo;
 public enum Sexo { MASCULINO, FEMENINO };
&nbsp;
 public Sexo getSexo() {
 return sexo;
 }
 public void setSexo(Sexo sexo) {
 this.sexo = sexo;
 }
&nbsp;
}
&nbsp;</code></pre>
      Y ahora, la auténtica herencia de entidades, una entidad que extiende de
      otra entidad:<br>
      <pre><code class="language-java">package org.openxava.test.model;
&nbsp;
import javax.persistence.*;
&nbsp;
/**
 *
 * @author Javier Paniza
 */
&nbsp;
@<a href="http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+Entity">Entity</a>
@DiscriminatorValue("PRO")
public class Programador extends Humano {
&nbsp;
 @Column(length=20)
 private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> lenguajePrincipal;
&nbsp;
 public <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> getLenguajePrincipal() {
 return lenguajePrincipal;
 }
&nbsp;
 public void setLenguajePrincipal(<a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> lenguajePrincipal) {
 this.lenguajePrincipal = lenguajePrincipal;
 }
&nbsp;
}
&nbsp;</code></pre>
      Podemo crear un <a class="wiki_link" href="application_es.html">módulo
        OpenXava</a> para <em>Humano</em> y <em>Programador</em> (no para <em>Identificable</em>
      ni <em>ConNombre</em> directamente). En el módulo de <em>Programador</em>
      el usuario puede acceder solo a programadores, por otra parte usando el
      módulo de <em>Humano</em> el usuario puede acceder a objetos de tipo <em>Humano</em>
      y <em>Programador</em>. Además cuando el usuario trata de visualizar el
      detalle de un <em>Programador</em> desde el módulo de <em>Humano</em> se
      mostrará la vista de <em>Programador</em>. Polimorfismo puro.<br>
      A partir de v4.5 OpenXava soporta todas las características de la herencia
      de JPA, incluyendo una única tabla por jerarquica, tabla para superclase y
      tabla para subclase (joined) y tabla por clase como estrategias de mapeo,
      antes de v4.5 sólo <em><a class="wiki_link_ext" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/AttributeOverrides.html"

          rel="nofollow">@AttributeOverrides</a></em> y la estrategia de una
      única tabla por jerarquía se soportaban.<br>
      <h2 id="toc36"><a name="Modelo-Clave+multiple"></a>Clave múltiple</h2>
      La forma preferida para definir la clave de una entidad es una clave única
      autogenerada (anotada con <em><a class="wiki_link_ext" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/Id.html"

          rel="nofollow">@Id</a></em> y <em><a class="wiki_link_ext" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/GeneratedValue.html"

          rel="nofollow">@GeneratedValue</a></em>), pero a veces, por ejemplo
      cuando vamos contra bases de datos legadas, necesitamos tener una entidad
      mapeada a una tabla que usa varias columnas como clave. Este caso se pude
      resolver con JPA (y por tanto con OpenXava) de dos formas, usando <em><a

          class="wiki_link_ext" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/IdClass.html"

          rel="nofollow">@IdClass</a></em> o usando <em><a class="wiki_link_ext"

          href="http://java.sun.com/javaee/5/docs/api/javax/persistence/EmbeddedId.html"

          rel="nofollow">@EmbeddedId</a></em><br>
      <h3 id="toc37"><a name="Modelo-Clave+multiple-Clase+id"></a>Clase id</h3>
      En este caso usamos <em><a class="wiki_link_ext" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/IdClass.html"

          rel="nofollow">@IdClass</a></em> en nuestra entidad para indicar una
      clase clave, y marcamos las propiedades clave como <em><a class="wiki_link_ext"

          href="http://java.sun.com/javaee/5/docs/api/javax/persistence/Id.html"

          rel="nofollow">@Id</a></em> en nuestra entidad:<br>
      <pre><code class="language-java">package org.openxava.test.model;
&nbsp;
import javax.persistence.*;
&nbsp;
import org.openxava.annotations.*;
import org.openxava.jpa.*;
&nbsp;
/**
 *
 * @author Javier Paniza
 */
&nbsp;
@<a href="http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+Entity">Entity</a>
@IdClass(AlmacenKey.class)
public class Almacen {
&nbsp;
 @Id
 // Column también se especifica en AlmacenKey por un bug en Hibernate, ver
 // http://opensource.atlassian.com/projects/hibernate/browse/ANN-361
 @Column(length=3, name="ZONA")
 private int codigoZona;
&nbsp;
 @Id @Column(length=3)
 private int codigo;
&nbsp;
 @Column(length=40) @Required
 private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> nombre;
&nbsp;
&nbsp;
 public <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> getNombre() {
 return nombre;
 }
&nbsp;
 public void setNombre(<a

href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> nombre) {
 this.nombre = nombre;
 }
&nbsp;
 public int getCodigo() {
 return codigo;
 }
&nbsp;
 public void setCodigo(int codigo) {
 this.codigo = codigo;
 }
&nbsp;
 public int getCodigoZona() {
 return codigoZona;
 }
&nbsp;
 public void setCodigoZona(int codigoZona) {
 this.codigoZona = codigoZona;
 }
&nbsp;
}
&nbsp;</code></pre>
      También necesitamos declarar una clase id, una clase serializable normal y
      corriente con todas las propiedades clave de la entidad:<br>
      <pre><code class="language-java">package org.openxava.test.model;
&nbsp;
import java.io.*;
import javax.persistence.*;
&nbsp;
/**
 *
 * @author Javier Paniza
 */
&nbsp;
public class AlmacenKey implements <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/io/Serializable.html">Serializable</a> {
&nbsp;
 @Column(name="ZONE")
 private int codigoZona;
 private int codigo;
&nbsp;
 @<a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/Override.html">Override</a>
 public boolean equals(<a

href="http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+Object">Object</a> obj) {
 if (obj == null) return false;
 return obj.toString().equals(this.toString());
 }
&nbsp;
 @<a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/Override.html">Override</a>
 public int hashCode() {
 return toString().hashCode();
 }
&nbsp;
 @<a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/Override.html">Override</a>
 public <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> toString() {
 return "AlmacenKey::" + codigoZona + ":" + codigo;
 }
&nbsp;
 public int getCodigo() {
 return codigo;
 }
&nbsp;
 public void setCodigo(int codigo) {
 this.codigo = codigo;
 }
&nbsp;
 public int getCodigoZona() {
 return codigoZona;
 }
&nbsp;
 public void setCodigoZona(int codigoZona) {
 this.codigoZona = codigoZona;
 }
&nbsp;
}</code></pre>
      <h3 id="toc38"><a name="Modelo-Clave+multiple-Id+inscrustado"></a>Id
        inscrustado</h3>
      En este case tenemos una referencia a un objeto incrustado (<em><a class="wiki_link_ext"

          href="http://java.sun.com/javaee/5/docs/api/javax/persistence/Embeddable.html"

          rel="nofollow">@Embeddable</a></em>) marcada como <em><a class="wiki_link_ext"

          href="http://java.sun.com/javaee/5/docs/api/javax/persistence/EmbeddedId.html"

          rel="nofollow">@EmbeddedId</a></em>:<br>
      <pre><code class="language-java">package org.openxava.test.model;
&nbsp;
import javax.persistence.*;
&nbsp;
import org.openxava.annotations.*;
&nbsp;
/**
 *
 * @author Javier Paniza
 */
&nbsp;
@<a href="http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+Entity">Entity</a>
public class Almacen {
&nbsp;
 @EmbeddedId
 private AlmacenKey clave;
&nbsp;
 @Column(length=40) @Required
 private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> nombre;
&nbsp;
 public AlmacenKey getClave() {
 return clave;
 }
&nbsp;
 public void setClave(AlmacenKey clave) {
 this.clave = clave;
 }
&nbsp;
 public <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> getNombre() {
 return nombre;
 }
&nbsp;
 public void setNombre(<a

href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> nombre) {
 this.nombre = nombre;
 }
&nbsp;
}
&nbsp;</code></pre>
      Y nuestra clave es una clase incrustable que contiene las propiedades
      clave:<br>
      <pre><code class="language-java">package org.openxava.test.model;
&nbsp;
import javax.persistence.*;
&nbsp;
/**
 *
 * @author Javier Paniza
 */
&nbsp;
@Embeddable
public class AlmacenKey implements java.io.<a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/io/Serializable.html">Serializable</a> {
&nbsp;
&nbsp;
 @Column(length=3, name="ZONA")
 private int codigoZona;
&nbsp;
 @Column(length=3)
 private int codigo;
&nbsp;
 public int getCodigo() {
 return codigo;
 }
&nbsp;
 public void setCodigo(int codigo) {
 this.codigo = codigo;
 }
&nbsp;
 public int getCodigoZona() {
 return codigoZona;
 }
&nbsp;
 public void setCodigoZona(int codigoZona) {
 this.codigoZona = codigoZona;
 }
&nbsp;
}</code></pre>
      <h2 id="toc39"><a name="Modelo-Bean Validation"></a>Bean Validation</h2>
      OpenXava tiene soporte completo del estándar Java para validación: <a class="wiki_link_ext"

        href="http://beanvalidation.org/" rel="nofollow">Bean Validation</a>.
      (1.1 JSR-349 desde v5.3 y 1.0 JSR-303 desde v4.1) Podemos definir nuestras
      propias restricciones en nuestras entidades como se explica en la
      especificación <em>Bean Validation</em>, y OpenXava las reconocerá,
      mostrando los mensajes de error correspondientes al usuario. Consulta la <a

        class="wiki_link_ext" href="https://docs.jboss.org/hibernate/validator/6.0/reference/en-US/html_single/"

        rel="nofollow">última documentación de Hibernate Validator</a> para
      aprender como escribir un validador JSR-349, ya que la versión actual de
      Hibernate Validator implementa JSR-349.<br>
      Además, a partir de v5.3 las anotaciones de OpenXava <em><a class="wiki_link_ext"

          href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/Required.html"

          rel="nofollow">@Required</a></em>, <em><a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/PropertyValidator.html"

          rel="nofollow">@PropertyValidator</a></em> y <em><a class="wiki_link_ext"

          href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/EntityValidator.html"

          rel="nofollow">@EntityValidator</a></em> están definidas como
      restricciones de Bean Validation, esto significa que cuando grabamos una
      entidad usando directamente JPA estas validaciones se aplicarán.<br>
      Por otra parte, <em><a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/RemoveValidator.html"

          rel="nofollow">@RemoveValidator</a></em>, <em>@PropertyValidator(onlyOnCreate=true)</em>,
      <em>EntityValidator(onlyOnCreate=true)</em> y la característica de <a class="wiki_link"

        href="#Modelo-Propiedades-Validador%20por%20defecto%20%28nuevo%20en%20v2.0.3%29">validador
        por defecto</a> de OpenXava no son reconocidas ni por Bean Validation ni
      por JPA, sino solo por OpenXava.<br>
      <h3 id="toc40"><a name="Modelo-Bean Validation-@AssertTrue"></a>@AssertTrue</h3>
      A partir de v4.9 OpenXava permite inyectar propiedades y propiedades
      calificadas (propiedades de referencias) del bean validado, en el mensaje
      identificado mediante el elemento message de <em><a class="wiki_link_ext"

          href="http://docs.oracle.com/javaee/6/api/javax/validation/constraints/AssertTrue.html"

          rel="nofollow">AssertTrue</a></em>. Por ejemplo:<br>
      En este caso tenemos a <em>@AssertTrue</em> anotando el campo de la
      Entidad:<br>
      <pre><code class="language-java">import javax.persistence.*;
import org.openxava.annotations.*;
import org.openxava.model.*
import javax.validation.constraints.*;
&nbsp;
@<a href="http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+Entity">Entity</a>
public class Conductor extends Identifiable{
&nbsp;
 @Required
 @Column(length = 40)
 private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> nombre;
&nbsp;
 @AssertTrue(message = "{no_puede_conducir}")
 private boolean puedeConducir;
&nbsp;
 //getters y setters...
}</code></pre>
      <em>{no_puede_conducir}</em> es el identificador de mensaje que se
      encuentra declarado en el archivo i18n así:<br>
      <pre><code class="language-text">no_puede_conducir=Conductor {nombre} no puede ser registrado: debe aprobar el examen de conducir</code></pre>
      Si intentamos crear una entidad con <em>nombre=MIGUEL GRAU</em> y <em>puedeConducir=false</em>
      se mostrará el mensaje de error:<br>
      <br>
      <em>Conductor MIGUEL GRAU no puede ser registrado: debe aprobar el examen
        de conducir</em><br>
      <br>
      En este caso tenemos a <em>@AssertTrue</em> anotando un método de la
      Entidad:<br>
      <pre><code class="language-java">import javax.persistence.*;
import org.openxava.annotations.*;
import org.openxava.model.*;
import javax.validation.constraints.*;
&nbsp;
@<a href="http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+Entity">Entity</a>
public class Vehiculo extends Identifiable{
&nbsp;
 @Required
 @Column(length = 15)
 private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> tipo;
&nbsp;
 @Required
 @Column(length = 7)
 private <a href="http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html">String</a> placa;
&nbsp;
 private boolean puedeCircular;
&nbsp;
 @ManyToOne
 private Conductor conductor;
&nbsp;
 @AssertTrue(message="{no_puede_circular}")
 private boolean isAptoParaCircular(){
     return driver == null || roadworthy;
 }
&nbsp;
 //getters y setters...
}</code></pre>
      <em>{no_puede_circular}</em> es el identificador de mensaje que se
      encuentra declarado en el archivo i18n así:<br>
      <pre><code class="language-text">no_puede_circular={tipo} de placa {placa} no es apto para circular. No se puede asignar al conductor {conductor.nombre}</code></pre>
      Si tenemos la entidad con: tipo=AUTO, placa=A1-0001 y puedeCircular=false;
      e intentamos asignar conductor (nombre=MIGUEL GRAU), el método de
      validación fallará y se mostrará el mensaje de error:<br>
      <br>
      <em>AUTO de placa A1-0001 no es apto para circular. No se puede asignar al
        conductor MIGUEL GRAU</em><br>
      <br>
      <h2 id="toc41"><a name="Modelo-Hibernate Validator (nuevo en v3.0.1)"></a>Hibernate
        Validator <em>(nuevo en v3.0.1)</em></h2>
      OpenXava tiene soporte completo de <a class="wiki_link_ext" href="http://validator.hibernate.org/"

        rel="nofollow">Hibernate Validator</a> con soporte de Bean Validation <em>(nuevo
        en v4.1)</em>. Hibernate Validator 3.x (con la vieja API) se soportó
      hasta v5.2.x. Podemos definir nuestras propias restricciones en nuestras
      entidades como se explica en la <span class="wiki_link_ext">documentación
        de Hibernate Validator</span>, y OpenXava las reconocerá, mostrando los
      mensajes de error correspondientes al usuario.<br>
      Además, las anotaciones de OpenXava <em><a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/Required.html"

          rel="nofollow">@Required</a></em>, <em><a class="wiki_link_ext" href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/PropertyValidator.html"

          rel="nofollow">@PropertyValidator</a></em> y <em><a class="wiki_link_ext"

          href="http://www.openxava.org/OpenXavaDoc/apidocs/org/openxava/annotations/EntityValidator.html"

          rel="nofollow">@EntityValidator</a></em> están definidas como
      restricciones de Hibernate Validator 3.x hasta v5.2.x y como restricciones
      de Bean Validation a partir de v5.3, esto significa que cuando grabamos
      una entidad usando directamente JPA estas validaciones se aplicarán. </div>
  </body>
</html>
